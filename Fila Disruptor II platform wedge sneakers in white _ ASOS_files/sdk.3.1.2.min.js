/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/

/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   2.0.0
 */

/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */

/*! jws-3.0.2 (c) 2013 Kenji Urushima | kjur.github.com/jsjws/license
 */

/*
 * jws.js - JSON Web Signature Class
 *
 * version: 3.0.2 (2013 Sep 24)
 *
 * Copyright (c) 2010-2013 Kenji Urushima (kenji.urushima@gmail.com)
 *
 * This software is licensed under the terms of the MIT License.
 * http://kjur.github.com/jsjws/license/
 *
 * The above copyright and license notice shall be 
 * included in all copies or substantial portions of the Software.
 */

/**
 * @fileOverview
 * @name jws-3.0.js
 * @author Kenji Urushima kenji.urushima@gmail.com
 * @version 3.0.1 (2013-Sep-24)
 * @since jsjws 1.0
 * @license <a href="http://kjur.github.io/jsjws/license/">MIT License</a>
 */

/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */

// Copyright (c) 2005  Tom Wu

// Copyright (c) 2005-2009  Tom Wu

/*! rsapem-1.1.js (c) 2012 Kenji Urushima | kjur.github.com/jsrsasign/license
 */

// Copyright (c) 2010-2013 Kenji Urushima (kenji.urushima@gmail.com)

// This software is licensed under the terms of the MIT License.

// http://kjur.github.com/jsrsasign/license/

// The above copyright and license notice shall be 

/**
 * @fileOverview
 * @name rsapem-1.1.js
 * @author Kenji Urushima kenji.urushima@gmail.com
 * @version 1.1
 * @license <a href="http://kjur.github.io/jsrsasign/license/">MIT License</a>
 */

/*! rsasign-1.2.7.js (c) 2012 Kenji Urushima | kjur.github.com/jsrsasign/license
 */

/*! asn1hex-1.1.5.js (c) 2012-2014 Kenji Urushima | kjur.github.com/jsrsasign/license
 */

/*
 * asn1hex.js - Hexadecimal represented ASN.1 string library
 *
 * Copyright (c) 2010-2014 Kenji Urushima (kenji.urushima@gmail.com)
 *
 * This software is licensed under the terms of the MIT License.
 * http://kjur.github.com/jsrsasign/license/
 *
 * The above copyright and license notice shall be 
 * included in all copies or substantial portions of the Software.
 */

/**
 * @fileOverview
 * @name asn1hex-1.1.js
 * @author Kenji Urushima kenji.urushima@gmail.com
 * @version asn1hex 1.1.5 (2014-May-25)
 * @license <a href="http://kjur.github.io/jsrsasign/license/">MIT License</a>
 */

/*! x509-1.1.3.js (c) 2012-2014 Kenji Urushima | kjur.github.com/jsrsasign/license
 */

/* 
 * x509.js - X509 class to read subject public key from certificate.
 *
 * Copyright (c) 2010-2014 Kenji Urushima (kenji.urushima@gmail.com)
 *
 * This software is licensed under the terms of the MIT License.
 * http://kjur.github.com/jsrsasign/license
 *
 * The above copyright and license notice shall be 
 * included in all copies or substantial portions of the Software.
 */

/**
 * @fileOverview
 * @name x509-1.1.js
 * @author Kenji Urushima kenji.urushima@gmail.com
 * @version x509 1.1.3 (2014-May-17)
 * @since jsrsasign 1.x.x
 * @license <a href="http://kjur.github.io/jsrsasign/license/">MIT License</a>
 */

/*! crypto-1.1.5.js (c) 2013 Kenji Urushima | kjur.github.com/jsrsasign/license
 */

/*
 * crypto.js - Cryptographic Algorithm Provider class
 *
 * Copyright (c) 2013 Kenji Urushima (kenji.urushima@gmail.com)
 *
 * This software is licensed under the terms of the MIT License.
 * http://kjur.github.com/jsrsasign/license
 *
 * The above copyright and license notice shall be 
 * included in all copies or substantial portions of the Software.
 */

/**
 * @fileOverview
 * @name crypto-1.1.js
 * @author Kenji Urushima kenji.urushima@gmail.com
 * @version 1.1.5 (2013-Oct-06)
 * @since jsrsasign 2.2
 * @license <a href="http://kjur.github.io/jsrsasign/license/">MIT License</a>
 */

/*! base64x-1.1.3 (c) 2012-2014 Kenji Urushima | kjur.github.com/jsjws/license
 */

/*
 * base64x.js - Base64url and supplementary functions for Tom Wu's base64.js library
 *
 * version: 1.1.3 (2014 May 25)
 *
 * Copyright (c) 2012-2014 Kenji Urushima (kenji.urushima@gmail.com)
 *
 * This software is licensed under the terms of the MIT License.
 * http://kjur.github.com/jsjws/license/
 *
 * The above copyright and license notice shall be 
 * included in all copies or substantial portions of the Software.
 *
 * DEPENDS ON:
 *   - base64.js - Tom Wu's Base64 library
 */

/*
 * Copyright 2015 Dominick Baier, Brock Allen
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

function hex2b64(e){var t,n,r="";for(t=0;t+3<=e.length;t+=3)n=parseInt(e.substring(t,t+3),16),r+=b64map.charAt(n>>6)+b64map.charAt(n&63);t+1==e.length?(n=parseInt(e.substring(t,t+1),16),r+=b64map.charAt(n<<2)):t+2==e.length&&(n=parseInt(e.substring(t,t+2),16),r+=b64map.charAt(n>>2)+b64map.charAt((n&3)<<4));if(b64pad)while((r.length&3)>0)r+=b64pad;return r}function b64tohex(e){var t="",n,r=0,i,s;for(n=0;n<e.length;++n){if(e.charAt(n)==b64pad)break;s=b64map.indexOf(e.charAt(n));if(s<0)continue;r==0?(t+=int2char(s>>2),i=s&3,r=1):r==1?(t+=int2char(i<<2|s>>4),i=s&15,r=2):r==2?(t+=int2char(i),t+=int2char(s>>2),i=s&3,r=3):(t+=int2char(i<<2|s>>4),t+=int2char(s&15),r=0)}return r==1&&(t+=int2char(i<<2)),t}function b64toBA(e){var t=b64tohex(e),n,r=new Array;for(n=0;2*n<t.length;++n)r[n]=parseInt(t.substring(2*n,2*n+2),16);return r}function BigInteger(e,t,n){e!=null&&("number"==typeof e?this.fromNumber(e,t,n):t==null&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function nbi(){return new BigInteger(null)}function am1(e,t,n,r,i,s){while(--s>=0){var o=t*this[e++]+n[r]+i;i=Math.floor(o/67108864),n[r++]=o&67108863}return i}function am2(e,t,n,r,i,s){var o=t&32767,u=t>>15;while(--s>=0){var a=this[e]&32767,f=this[e++]>>15,l=u*a+f*o;a=o*a+((l&32767)<<15)+n[r]+(i&1073741823),i=(a>>>30)+(l>>>15)+u*f+(i>>>30),n[r++]=a&1073741823}return i}function am3(e,t,n,r,i,s){var o=t&16383,u=t>>14;while(--s>=0){var a=this[e]&16383,f=this[e++]>>14,l=u*a+f*o;a=o*a+((l&16383)<<14)+n[r]+i,i=(a>>28)+(l>>14)+u*f,n[r++]=a&268435455}return i}function int2char(e){return BI_RM.charAt(e)}function intAt(e,t){var n=BI_RC[e.charCodeAt(t)];return n==null?-1:n}function bnpCopyTo(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function bnpFromInt(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function nbv(e){var t=nbi();return t.fromInt(e),t}function bnpFromString(e,t){var n;if(t==16)n=4;else if(t==8)n=3;else if(t==256)n=8;else if(t==2)n=1;else if(t==32)n=5;else{if(t!=4){this.fromRadix(e,t);return}n=2}this.t=0,this.s=0;var r=e.length,i=!1,s=0;while(--r>=0){var o=n==8?e[r]&255:intAt(e,r);if(o<0){e.charAt(r)=="-"&&(i=!0);continue}i=!1,s==0?this[this.t++]=o:s+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this[this.t++]=o>>this.DB-s):this[this.t-1]|=o<<s,s+=n,s>=this.DB&&(s-=this.DB)}n==8&&(e[0]&128)!=0&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){var e=this.s&this.DM;while(this.t>0&&this[this.t-1]==e)--this.t}function bnToString(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(e==16)t=4;else if(e==8)t=3;else if(e==2)t=1;else if(e==32)t=5;else{if(e!=4)return this.toRadix(e);t=2}var n=(1<<t)-1,r,i=!1,s="",o=this.t,u=this.DB-o*this.DB%t;if(o-->0){u<this.DB&&(r=this[o]>>u)>0&&(i=!0,s=int2char(r));while(o>=0)u<t?(r=(this[o]&(1<<u)-1)<<t-u,r|=this[--o]>>(u+=this.DB-t)):(r=this[o]>>(u-=t)&n,u<=0&&(u+=this.DB,--o)),r>0&&(i=!0),i&&(s+=int2char(r))}return i?s:"0"}function bnNegate(){var e=nbi();return BigInteger.ZERO.subTo(this,e),e}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(e){var t=this.s-e.s;if(t!=0)return t;var n=this.t;t=n-e.t;if(t!=0)return this.s<0?-t:t;while(--n>=0)if((t=this[n]-e[n])!=0)return t;return 0}function nbits(e){var t=1,n;return(n=e>>>16)!=0&&(e=n,t+=16),(n=e>>8)!=0&&(e=n,t+=8),(n=e>>4)!=0&&(e=n,t+=4),(n=e>>2)!=0&&(e=n,t+=2),(n=e>>1)!=0&&(e=n,t+=1),t}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function bnpDRShiftTo(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function bnpLShiftTo(e,t){var n=e%this.DB,r=this.DB-n,i=(1<<r)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM,u;for(u=this.t-1;u>=0;--u)t[u+s+1]=this[u]>>r|o,o=(this[u]&i)<<n;for(u=s-1;u>=0;--u)t[u]=0;t[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()}function bnpRShiftTo(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t){t.t=0;return}var r=e%this.DB,i=this.DB-r,s=(1<<r)-1;t[0]=this[n]>>r;for(var o=n+1;o<this.t;++o)t[o-n-1]|=(this[o]&s)<<i,t[o-n]=this[o]>>r;r>0&&(t[this.t-n-1]|=(this.s&s)<<i),t.t=this.t-n,t.clamp()}function bnpSubTo(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r-=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()}function bnpMultiplyTo(e,t){var n=this.abs(),r=e.abs(),i=n.t;t.t=i+r.t;while(--i>=0)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&BigInteger.ZERO.subTo(t,t)}function bnpSquareTo(e){var t=this.abs(),n=e.t=2*t.t;while(--n>=0)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function bnpDivRemTo(e,t,n){var r=e.abs();if(r.t<=0)return;var i=this.abs();if(i.t<r.t){t!=null&&t.fromInt(0),n!=null&&this.copyTo(n);return}n==null&&(n=nbi());var s=nbi(),o=this.s,u=e.s,a=this.DB-nbits(r[r.t-1]);a>0?(r.lShiftTo(a,s),i.lShiftTo(a,n)):(r.copyTo(s),i.copyTo(n));var f=s.t,l=s[f-1];if(l==0)return;var c=l*(1<<this.F1)+(f>1?s[f-2]>>this.F2:0),h=this.FV/c,p=(1<<this.F1)/c,d=1<<this.F2,v=n.t,m=v-f,g=t==null?nbi():t;s.dlShiftTo(m,g),n.compareTo(g)>=0&&(n[n.t++]=1,n.subTo(g,n)),BigInteger.ONE.dlShiftTo(f,g),g.subTo(s,s);while(s.t<f)s[s.t++]=0;while(--m>=0){var y=n[--v]==l?this.DM:Math.floor(n[v]*h+(n[v-1]+d)*p);if((n[v]+=s.am(0,y,n,m,0,f))<y){s.dlShiftTo(m,g),n.subTo(g,n);while(n[v]<--y)n.subTo(g,n)}}t!=null&&(n.drShiftTo(f,t),o!=u&&BigInteger.ZERO.subTo(t,t)),n.t=f,n.clamp(),a>0&&n.rShiftTo(a,n),o<0&&BigInteger.ZERO.subTo(n,n)}function bnMod(e){var t=nbi();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(BigInteger.ZERO)>0&&e.subTo(t,t),t}function Classic(e){this.m=e}function cConvert(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function cRevert(e){return e}function cReduce(e){e.divRemTo(this.m,null,e)}function cMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function cSqrTo(e,t){e.squareTo(t),this.reduce(t)}function bnpInvDigit(){if(this.t<1)return 0;var e=this[0];if((e&1)==0)return 0;var t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function Montgomery(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function montConvert(e){var t=nbi();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(BigInteger.ZERO)>0&&this.m.subTo(t,t),t}function montRevert(e){var t=nbi();return e.copyTo(t),this.reduce(t),t}function montReduce(e){while(e.t<=this.mt2)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=e[t]&32767,r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;n=t+this.m.t,e[n]+=this.m.am(0,r,e,t,0,this.m.t);while(e[n]>=e.DV)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function montSqrTo(e,t){e.squareTo(t),this.reduce(t)}function montMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(e,t){if(e>4294967295||e<1)return BigInteger.ONE;var n=nbi(),r=nbi(),i=t.convert(this),s=nbits(e)-1;i.copyTo(n);while(--s>=0){t.sqrTo(n,r);if((e&1<<s)>0)t.mulTo(r,i,n);else{var o=n;n=r,r=o}}return t.revert(n)}function bnModPowInt(e,t){var n;return e<256||t.isEven()?n=new Classic(t):n=new Montgomery(t),this.exp(e,n)}function bnClone(){var e=nbi();return this.copyTo(e),e}function bnIntValue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return this.t==0?this.s:this[0]<<24>>24}function bnShortValue(){return this.t==0?this.s:this[0]<<16>>16}function bnpChunkSize(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function bnSigNum(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function bnpToRadix(e){e==null&&(e=10);if(this.signum()==0||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=nbv(n),i=nbi(),s=nbi(),o="";this.divRemTo(r,i,s);while(i.signum()>0)o=(n+s.intValue()).toString(e).substr(1)+o,i.divRemTo(r,i,s);return s.intValue().toString(e)+o}function bnpFromRadix(e,t){this.fromInt(0),t==null&&(t=10);var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,s=0,o=0;for(var u=0;u<e.length;++u){var a=intAt(e,u);if(a<0){e.charAt(u)=="-"&&this.signum()==0&&(i=!0);continue}o=t*o+a,++s>=n&&(this.dMultiply(r),this.dAddOffset(o,0),s=0,o=0)}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(o,0)),i&&BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(e-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);while(!this.isProbablePrime(t))this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(BigInteger.ONE.shiftLeft(e-1),this)}else{var r=new Array,i=e&7;r.length=(e>>3)+1,t.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}}function bnToByteArray(){var e=this.t,t=new Array;t[0]=this.s;var n=this.DB-e*this.DB%8,r,i=0;if(e-->0){n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);while(e>=0){n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),(r&128)!=0&&(r|=-256),i==0&&(this.s&128)!=(r&128)&&++i;if(i>0||r!=this.s)t[i++]=r}}return t}function bnEquals(e){return this.compareTo(e)==0}function bnMin(e){return this.compareTo(e)<0?this:e}function bnMax(e){return this.compareTo(e)>0?this:e}function bnpBitwiseTo(e,t,n){var r,i,s=Math.min(e.t,this.t);for(r=0;r<s;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){i=e.s&this.DM;for(r=s;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{i=this.s&this.DM;for(r=s;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}function op_and(e,t){return e&t}function bnAnd(e){var t=nbi();return this.bitwiseTo(e,op_and,t),t}function op_or(e,t){return e|t}function bnOr(e){var t=nbi();return this.bitwiseTo(e,op_or,t),t}function op_xor(e,t){return e^t}function bnXor(e){var t=nbi();return this.bitwiseTo(e,op_xor,t),t}function op_andnot(e,t){return e&~t}function bnAndNot(e){var t=nbi();return this.bitwiseTo(e,op_andnot,t),t}function bnNot(){var e=nbi();for(var t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e}function bnShiftLeft(e){var t=nbi();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function bnShiftRight(e){var t=nbi();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function lbit(e){if(e==0)return-1;var t=0;return(e&65535)==0&&(e>>=16,t+=16),(e&255)==0&&(e>>=8,t+=8),(e&15)==0&&(e>>=4,t+=4),(e&3)==0&&(e>>=2,t+=2),(e&1)==0&&++t,t}function bnGetLowestSetBit(){for(var e=0;e<this.t;++e)if(this[e]!=0)return e*this.DB+lbit(this[e]);return this.s<0?this.t*this.DB:-1}function cbit(e){var t=0;while(e!=0)e&=e-1,++t;return t}function bnBitCount(){var e=0,t=this.s&this.DM;for(var n=0;n<this.t;++n)e+=cbit(this[n]^t);return e}function bnTestBit(e){var t=Math.floor(e/this.DB);return t>=this.t?this.s!=0:(this[t]&1<<e%this.DB)!=0}function bnpChangeBit(e,t){var n=BigInteger.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n}function bnSetBit(e){return this.changeBit(e,op_or)}function bnClearBit(e){return this.changeBit(e,op_andnot)}function bnFlipBit(e){return this.changeBit(e,op_xor)}function bnpAddTo(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r+=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r),t.t=n,t.clamp()}function bnAdd(e){var t=nbi();return this.addTo(e,t),t}function bnSubtract(e){var t=nbi();return this.subTo(e,t),t}function bnMultiply(e){var t=nbi();return this.multiplyTo(e,t),t}function bnSquare(){var e=nbi();return this.squareTo(e),e}function bnDivide(e){var t=nbi();return this.divRemTo(e,t,null),t}function bnRemainder(e){var t=nbi();return this.divRemTo(e,null,t),t}function bnDivideAndRemainder(e){var t=nbi(),n=nbi();return this.divRemTo(e,t,n),new Array(t,n)}function bnpDMultiply(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(e,t){if(e==0)return;while(this.t<=t)this[this.t++]=0;this[t]+=e;while(this[t]>=this.DV)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}function NullExp(){}function nNop(e){return e}function nMulTo(e,t,n){e.multiplyTo(t,n)}function nSqrTo(e,t){e.squareTo(t)}function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(e,t,n){var r=Math.min(this.t+e.t,t);n.s=0,n.t=r;while(r>0)n[--r]=0;var i;for(i=n.t-this.t;r<i;++r)n[r+this.t]=this.am(0,e[r],n,r,0,this.t);for(i=Math.min(e.t,t);r<i;++r)this.am(0,e[r],n,r,0,t-r);n.clamp()}function bnpMultiplyUpperTo(e,t,n){--t;var r=n.t=this.t+e.t-t;n.s=0;while(--r>=0)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}function Barrett(e){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function barrettConvert(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=nbi();return e.copyTo(t),this.reduce(t),t}function barrettRevert(e){return e}function barrettReduce(e){e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(e.compareTo(this.r2)<0)e.dAddOffset(1,this.m.t+1);e.subTo(this.r2,e);while(e.compareTo(this.m)>=0)e.subTo(this.m,e)}function barrettSqrTo(e,t){e.squareTo(t),this.reduce(t)}function barrettMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function bnModPow(e,t){var n=e.bitLength(),r,i=nbv(1),s;if(n<=0)return i;n<18?r=1:n<48?r=3:n<144?r=4:n<768?r=5:r=6,n<8?s=new Classic(t):t.isEven()?s=new Barrett(t):s=new Montgomery(t);var o=new Array,u=3,a=r-1,f=(1<<r)-1;o[1]=s.convert(this);if(r>1){var l=nbi();s.sqrTo(o[1],l);while(u<=f)o[u]=nbi(),s.mulTo(l,o[u-2],o[u]),u+=2}var c=e.t-1,h,p=!0,d=nbi(),v;n=nbits(e[c])-1;while(c>=0){n>=a?h=e[c]>>n-a&f:(h=(e[c]&(1<<n+1)-1)<<a-n,c>0&&(h|=e[c-1]>>this.DB+n-a)),u=r;while((h&1)==0)h>>=1,--u;(n-=u)<0&&(n+=this.DB,--c);if(p)o[h].copyTo(i),p=!1;else{while(u>1)s.sqrTo(i,d),s.sqrTo(d,i),u-=2;u>0?s.sqrTo(i,d):(v=i,i=d,d=v),s.mulTo(d,o[h],i)}while(c>=0&&(e[c]&1<<n)==0)s.sqrTo(i,d),v=i,i=d,d=v,--n<0&&(n=this.DB-1,--c)}return s.revert(i)}function bnGCD(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),s=n.getLowestSetBit();if(s<0)return t;i<s&&(s=i),s>0&&(t.rShiftTo(s,t),n.rShiftTo(s,n));while(t.signum()>0)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return s>0&&n.lShiftTo(s,n),n}function bnpModInt(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(t==0)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n}function bnModInverse(e){var t=e.isEven();if(this.isEven()&&t||e.signum()==0)return BigInteger.ZERO;var n=e.clone(),r=this.clone(),i=nbv(1),s=nbv(0),o=nbv(0),u=nbv(1);while(n.signum()!=0){while(n.isEven()){n.rShiftTo(1,n);if(t){if(!i.isEven()||!s.isEven())i.addTo(this,i),s.subTo(e,s);i.rShiftTo(1,i)}else s.isEven()||s.subTo(e,s);s.rShiftTo(1,s)}while(r.isEven()){r.rShiftTo(1,r);if(t){if(!o.isEven()||!u.isEven())o.addTo(this,o),u.subTo(e,u);o.rShiftTo(1,o)}else u.isEven()||u.subTo(e,u);u.rShiftTo(1,u)}n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(o,i),s.subTo(u,s)):(r.subTo(n,r),t&&o.subTo(i,o),u.subTo(s,u))}return r.compareTo(BigInteger.ONE)!=0?BigInteger.ZERO:u.compareTo(e)>=0?u.subtract(e):u.signum()<0?(u.addTo(e,u),u.signum()<0?u.add(e):u):u}function bnIsProbablePrime(e){var t,n=this.abs();if(n.t==1&&n[0]<=lowprimes[lowprimes.length-1]){for(t=0;t<lowprimes.length;++t)if(n[0]==lowprimes[t])return!0;return!1}if(n.isEven())return!1;t=1;while(t<lowprimes.length){var r=lowprimes[t],i=t+1;while(i<lowprimes.length&&r<lplim)r*=lowprimes[i++];r=n.modInt(r);while(t<i)if(r%lowprimes[t++]==0)return!1}return n.millerRabin(e)}function bnpMillerRabin(e){var t=this.subtract(BigInteger.ONE),n=t.getLowestSetBit();if(n<=0)return!1;var r=t.shiftRight(n);e=e+1>>1,e>lowprimes.length&&(e=lowprimes.length);var i=nbi();for(var s=0;s<e;++s){i.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var o=i.modPow(r,this);if(o.compareTo(BigInteger.ONE)!=0&&o.compareTo(t)!=0){var u=1;while(u++<n&&o.compareTo(t)!=0){o=o.modPowInt(2,this);if(o.compareTo(BigInteger.ONE)==0)return!1}if(o.compareTo(t)!=0)return!1}}return!0}function parseBigInt(e,t){return new BigInteger(e,t)}function linebrk(e,t){var n="",r=0;while(r+t<e.length)n+=e.substring(r,r+t)+"\n",r+=t;return n+e.substring(r,e.length)}function byte2Hex(e){return e<16?"0"+e.toString(16):e.toString(16)}function pkcs1pad2(e,t){if(t<e.length+11)return alert("Message too long for RSA"),null;var n=new Array,r=e.length-1;while(r>=0&&t>0){var i=e.charCodeAt(r--);i<128?n[--t]=i:i>127&&i<2048?(n[--t]=i&63|128,n[--t]=i>>6|192):(n[--t]=i&63|128,n[--t]=i>>6&63|128,n[--t]=i>>12|224)}n[--t]=0;var s=new SecureRandom,o=new Array;while(t>2){o[0]=0;while(o[0]==0)s.nextBytes(o);n[--t]=o[0]}return n[--t]=2,n[--t]=0,new BigInteger(n)}function oaep_mgf1_arr(e,t,n){var r="",i=0;while(r.length<t)r+=n(String.fromCharCode.apply(String,e.concat([(i&4278190080)>>24,(i&16711680)>>16,(i&65280)>>8,i&255]))),i+=1;return r}function oaep_pad(e,t,n){if(e.length+2*SHA1_SIZE+2>t)throw"Message too long for RSA";var r="",i;for(i=0;i<t-e.length-2*SHA1_SIZE-2;i+=1)r+="\0";var s=rstr_sha1("")+r+""+e,o=new Array(SHA1_SIZE);(new SecureRandom).nextBytes(o);var u=oaep_mgf1_arr(o,s.length,n||rstr_sha1),a=[];for(i=0;i<s.length;i+=1)a[i]=s.charCodeAt(i)^u.charCodeAt(i);var f=oaep_mgf1_arr(a,o.length,rstr_sha1),l=[0];for(i=0;i<o.length;i+=1)l[i+1]=o[i]^f.charCodeAt(i);return new BigInteger(l.concat(a))}function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function RSASetPublic(e,t){this.isPublic=!0,typeof e!="string"?(this.n=e,this.e=t):e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16)):alert("Invalid RSA public key")}function RSADoPublic(e){return e.modPowInt(this.e,this.n)}function RSAEncrypt(e){var t=pkcs1pad2(e,this.n.bitLength()+7>>3);if(t==null)return null;var n=this.doPublic(t);if(n==null)return null;var r=n.toString(16);return(r.length&1)==0?r:"0"+r}function RSAEncryptOAEP(e,t){var n=oaep_pad(e,this.n.bitLength()+7>>3,t);if(n==null)return null;var r=this.doPublic(n);if(r==null)return null;var i=r.toString(16);return(i.length&1)==0?i:"0"+i}function pkcs1unpad2(e,t){var n=e.toByteArray(),r=0;while(r<n.length&&n[r]==0)++r;if(n.length-r!=t-1||n[r]!=2)return null;++r;while(n[r]!=0)if(++r>=n.length)return null;var i="";while(++r<n.length){var s=n[r]&255;s<128?i+=String.fromCharCode(s):s>191&&s<224?(i+=String.fromCharCode((s&31)<<6|n[r+1]&63),++r):(i+=String.fromCharCode((s&15)<<12|(n[r+1]&63)<<6|n[r+2]&63),r+=2)}return i}function oaep_mgf1_str(e,t,n){var r="",i=0;while(r.length<t)r+=n(e+String.fromCharCode.apply(String,[(i&4278190080)>>24,(i&16711680)>>16,(i&65280)>>8,i&255])),i+=1;return r}function oaep_unpad(e,t,n){e=e.toByteArray();var r;for(r=0;r<e.length;r+=1)e[r]&=255;while(e.length<t)e.unshift(0);e=String.fromCharCode.apply(String,e);if(e.length<2*SHA1_SIZE+2)throw"Cipher too short";var i=e.substr(1,SHA1_SIZE),s=e.substr(SHA1_SIZE+1),o=oaep_mgf1_str(s,SHA1_SIZE,n||rstr_sha1),u=[],r;for(r=0;r<i.length;r+=1)u[r]=i.charCodeAt(r)^o.charCodeAt(r);var a=oaep_mgf1_str(String.fromCharCode.apply(String,u),e.length-SHA1_SIZE,rstr_sha1),f=[];for(r=0;r<s.length;r+=1)f[r]=s.charCodeAt(r)^a.charCodeAt(r);f=String.fromCharCode.apply(String,f);if(f.substr(0,SHA1_SIZE)!==rstr_sha1(""))throw"Hash mismatch";f=f.substr(SHA1_SIZE);var l=f.indexOf(""),c=l!=-1?f.substr(0,l).lastIndexOf("\0"):-1;if(c+1!=l)throw"Malformed data";return f.substr(l+1)}function RSASetPrivate(e,t,n){this.isPrivate=!0,typeof e!="string"?(this.n=e,this.e=t,this.d=n):e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(n,16)):alert("Invalid RSA private key")}function RSASetPrivateEx(e,t,n,r,i,s,o,u){this.isPrivate=!0;if(e==null)throw"RSASetPrivateEx N == null";if(t==null)throw"RSASetPrivateEx E == null";if(e.length==0)throw"RSASetPrivateEx N.length == 0";if(t.length==0)throw"RSASetPrivateEx E.length == 0";e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(n,16),this.p=parseBigInt(r,16),this.q=parseBigInt(i,16),this.dmp1=parseBigInt(s,16),this.dmq1=parseBigInt(o,16),this.coeff=parseBigInt(u,16)):alert("Invalid RSA private key in RSASetPrivateEx")}function RSAGenerate(e,t){var n=new SecureRandom,r=e>>1;this.e=parseInt(t,16);var i=new BigInteger(t,16);for(;;){for(;;){this.p=new BigInteger(e-r,1,n);if(this.p.subtract(BigInteger.ONE).gcd(i).compareTo(BigInteger.ONE)==0&&this.p.isProbablePrime(10))break}for(;;){this.q=new BigInteger(r,1,n);if(this.q.subtract(BigInteger.ONE).gcd(i).compareTo(BigInteger.ONE)==0&&this.q.isProbablePrime(10))break}if(this.p.compareTo(this.q)<=0){var s=this.p;this.p=this.q,this.q=s}var o=this.p.subtract(BigInteger.ONE),u=this.q.subtract(BigInteger.ONE),a=o.multiply(u);if(a.gcd(i).compareTo(BigInteger.ONE)==0){this.n=this.p.multiply(this.q),this.d=i.modInverse(a),this.dmp1=this.d.mod(o),this.dmq1=this.d.mod(u),this.coeff=this.q.modInverse(this.p);break}}this.isPrivate=!0}function RSADoPrivate(e){if(this.p==null||this.q==null)return e.modPow(this.d,this.n);var t=e.mod(this.p).modPow(this.dmp1,this.p),n=e.mod(this.q).modPow(this.dmq1,this.q);while(t.compareTo(n)<0)t=t.add(this.p);return t.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)}function RSADecrypt(e){var t=parseBigInt(e,16),n=this.doPrivate(t);return n==null?null:pkcs1unpad2(n,this.n.bitLength()+7>>3)}function RSADecryptOAEP(e,t){var n=parseBigInt(e,16),r=this.doPrivate(n);return r==null?null:oaep_unpad(r,this.n.bitLength()+7>>3,t)}function _rsapem_pemToBase64(e){var t=e;return t=t.replace("-----BEGIN RSA PRIVATE KEY-----",""),t=t.replace("-----END RSA PRIVATE KEY-----",""),t=t.replace(/[ \n]+/g,""),t}function _rsapem_getPosArrayOfChildrenFromHex(e){var t=new Array,n=ASN1HEX.getStartPosOfV_AtObj(e,0),r=ASN1HEX.getPosOfNextSibling_AtObj(e,n),i=ASN1HEX.getPosOfNextSibling_AtObj(e,r),s=ASN1HEX.getPosOfNextSibling_AtObj(e,i),o=ASN1HEX.getPosOfNextSibling_AtObj(e,s),u=ASN1HEX.getPosOfNextSibling_AtObj(e,o),a=ASN1HEX.getPosOfNextSibling_AtObj(e,u),f=ASN1HEX.getPosOfNextSibling_AtObj(e,a),l=ASN1HEX.getPosOfNextSibling_AtObj(e,f);return t.push(n,r,i,s,o,u,a,f,l),t}function _rsapem_getHexValueArrayOfChildrenFromHex(e){var t=_rsapem_getPosArrayOfChildrenFromHex(e),n=ASN1HEX.getHexOfV_AtObj(e,t[0]),r=ASN1HEX.getHexOfV_AtObj(e,t[1]),i=ASN1HEX.getHexOfV_AtObj(e,t[2]),s=ASN1HEX.getHexOfV_AtObj(e,t[3]),o=ASN1HEX.getHexOfV_AtObj(e,t[4]),u=ASN1HEX.getHexOfV_AtObj(e,t[5]),a=ASN1HEX.getHexOfV_AtObj(e,t[6]),f=ASN1HEX.getHexOfV_AtObj(e,t[7]),l=ASN1HEX.getHexOfV_AtObj(e,t[8]),c=new Array;return c.push(n,r,i,s,o,u,a,f,l),c}function _rsapem_readPrivateKeyFromASN1HexString(e){var t=_rsapem_getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function _rsapem_readPrivateKeyFromPEMString(e){var t=_rsapem_pemToBase64(e),n=b64tohex(t),r=_rsapem_getHexValueArrayOfChildrenFromHex(n);this.setPrivateEx(r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}function _rsasign_getHexPaddedDigestInfoForString(e,t,n){var r=function(e){return KJUR.crypto.Util.hashString(e,n)},i=r(e);return KJUR.crypto.Util.getPaddedDigestInfoHex(i,n,t)}function _zeroPaddingOfSignature(e,t){var n="",r=t/4-e.length;for(var i=0;i<r;i++)n+="0";return n+e}function _rsasign_signString(e,t){var n=function(e){return KJUR.crypto.Util.hashString(e,t)},r=n(e);return this.signWithMessageHash(r,t)}function _rsasign_signWithMessageHash(e,t){var n=KJUR.crypto.Util.getPaddedDigestInfoHex(e,t,this.n.bitLength()),r=parseBigInt(n,16),i=this.doPrivate(r),s=i.toString(16);return _zeroPaddingOfSignature(s,this.n.bitLength())}function _rsasign_signStringWithSHA1(e){return _rsasign_signString.call(this,e,"sha1")}function _rsasign_signStringWithSHA256(e){return _rsasign_signString.call(this,e,"sha256")}function pss_mgf1_str(e,t,n){var r="",i=0;while(r.length<t)r+=hextorstr(n(rstrtohex(e+String.fromCharCode.apply(String,[(i&4278190080)>>24,(i&16711680)>>16,(i&65280)>>8,i&255])))),i+=1;return r}function _rsasign_signStringPSS(e,t,n){var r=function(e){return KJUR.crypto.Util.hashHex(e,t)},i=r(rstrtohex(e));return n===undefined&&(n=-1),this.signWithMessageHashPSS(i,t,n)}function _rsasign_signWithMessageHashPSS(e,t,n){var r=hextorstr(e),i=r.length,s=this.n.bitLength()-1,o=Math.ceil(s/8),u,a=function(e){return KJUR.crypto.Util.hashHex(e,t)};if(n===-1||n===undefined)n=i;else if(n===-2)n=o-i-2;else if(n<-2)throw"invalid salt length";if(o<i+n+2)throw"data too long";var f="";n>0&&(f=new Array(n),(new SecureRandom).nextBytes(f),f=String.fromCharCode.apply(String,f));var l=hextorstr(a(rstrtohex("\0\0\0\0\0\0\0\0"+r+f))),c=[];for(u=0;u<o-n-i-2;u+=1)c[u]=0;var h=String.fromCharCode.apply(String,c)+""+f,p=pss_mgf1_str(l,h.length,a),d=[];for(u=0;u<h.length;u+=1)d[u]=h.charCodeAt(u)^p.charCodeAt(u);var v=65280>>8*o-s&255;d[0]&=~v;for(u=0;u<i;u++)d.push(l.charCodeAt(u));return d.push(188),_zeroPaddingOfSignature(this.doPrivate(new BigInteger(d)).toString(16),this.n.bitLength())}function _rsasign_getDecryptSignatureBI(e,t,n){var r=new RSAKey;r.setPublic(t,n);var i=r.doPublic(e);return i}function _rsasign_getHexDigestInfoFromSig(e,t,n){var r=_rsasign_getDecryptSignatureBI(e,t,n),i=r.toString(16).replace(/^1f+00/,"");return i}function _rsasign_getAlgNameAndHashFromHexDisgestInfo(e){for(var t in KJUR.crypto.Util.DIGESTINFOHEAD){var n=KJUR.crypto.Util.DIGESTINFOHEAD[t],r=n.length;if(e.substring(0,r)==n){var i=[t,e.substring(r)];return i}}return[]}function _rsasign_verifySignatureWithArgs(e,t,n,r){var i=_rsasign_getHexDigestInfoFromSig(t,n,r),s=_rsasign_getAlgNameAndHashFromHexDisgestInfo(i);if(s.length==0)return!1;var o=s[0],u=s[1],a=function(e){return KJUR.crypto.Util.hashString(e,o)},f=a(e);return u==f}function _rsasign_verifyHexSignatureForMessage(e,t){var n=parseBigInt(e,16),r=_rsasign_verifySignatureWithArgs(t,n,this.n.toString(16),this.e.toString(16));return r}function _rsasign_verifyString(e,t){t=t.replace(_RE_HEXDECONLY,""),t=t.replace(/[ \n]+/g,"");var n=parseBigInt(t,16);if(n.bitLength()>this.n.bitLength())return 0;var r=this.doPublic(n),i=r.toString(16).replace(/^1f+00/,""),s=_rsasign_getAlgNameAndHashFromHexDisgestInfo(i);if(s.length==0)return!1;var o=s[0],u=s[1],a=function(e){return KJUR.crypto.Util.hashString(e,o)},f=a(e);return u==f}function _rsasign_verifyWithMessageHash(e,t){t=t.replace(_RE_HEXDECONLY,""),t=t.replace(/[ \n]+/g,"");var n=parseBigInt(t,16);if(n.bitLength()>this.n.bitLength())return 0;var r=this.doPublic(n),i=r.toString(16).replace(/^1f+00/,""),s=_rsasign_getAlgNameAndHashFromHexDisgestInfo(i);if(s.length==0)return!1;var o=s[0],u=s[1];return u==e}function _rsasign_verifyStringPSS(e,t,n,r){var i=function(e){return KJUR.crypto.Util.hashHex(e,n)},s=i(rstrtohex(e));return r===undefined&&(r=-1),this.verifyWithMessageHashPSS(s,t,n,r)}function _rsasign_verifyWithMessageHashPSS(e,t,n,r){var i=new BigInteger(t,16);if(i.bitLength()>this.n.bitLength())return!1;var s=function(e){return KJUR.crypto.Util.hashHex(e,n)},o=hextorstr(e),u=o.length,a=this.n.bitLength()-1,f=Math.ceil(a/8),l;if(r===-1||r===undefined)r=u;else if(r===-2)r=f-u-2;else if(r<-2)throw"invalid salt length";if(f<u+r+2)throw"data too long";var c=this.doPublic(i).toByteArray();for(l=0;l<c.length;l+=1)c[l]&=255;while(c.length<f)c.unshift(0);if(c[f-1]!==188)throw"encoded message does not end in 0xbc";c=String.fromCharCode.apply(String,c);var h=c.substr(0,f-u-1),p=c.substr(h.length,u),d=65280>>8*f-a&255;if((h.charCodeAt(0)&d)!==0)throw"bits beyond keysize not zero";var v=pss_mgf1_str(p,h.length,s),m=[];for(l=0;l<h.length;l+=1)m[l]=h.charCodeAt(l)^v.charCodeAt(l);m[0]&=~d;var g=f-u-r-2;for(l=0;l<g;l+=1)if(m[l]!==0)throw"leftmost octets not zero";if(m[g]!==1)throw"0x01 marker not found";return p===hextorstr(s(rstrtohex("\0\0\0\0\0\0\0\0"+o+String.fromCharCode.apply(String,m.slice(-r)))))}function X509(){this.subjectPublicKeyRSA=null,this.subjectPublicKeyRSA_hN=null,this.subjectPublicKeyRSA_hE=null,this.hex=null,this.getSerialNumberHex=function(){return ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,1])},this.getIssuerHex=function(){return ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,3])},this.getIssuerString=function(){return X509.hex2dn(ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,3]))},this.getSubjectHex=function(){return ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,5])},this.getSubjectString=function(){return X509.hex2dn(ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,5]))},this.getNotBefore=function(){var e=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,4,0]);return e=e.replace(/(..)/g,"%$1"),e=decodeURIComponent(e),e},this.getNotAfter=function(){var e=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,4,1]);return e=e.replace(/(..)/g,"%$1"),e=decodeURIComponent(e),e},this.readCertPEM=function(e){var t=X509.pemToHex(e),n=X509.getPublicKeyHexArrayFromCertHex(t),r=new RSAKey;r.setPublic(n[0],n[1]),this.subjectPublicKeyRSA=r,this.subjectPublicKeyRSA_hN=n[0],this.subjectPublicKeyRSA_hE=n[1],this.hex=t},this.readCertPEMWithoutRSAInit=function(e){var t=X509.pemToHex(e),n=X509.getPublicKeyHexArrayFromCertHex(t);this.subjectPublicKeyRSA.setPublic(n[0],n[1]),this.subjectPublicKeyRSA_hN=n[0],this.subjectPublicKeyRSA_hE=n[1],this.hex=t}}function Base64x(){}function stoBA(e){var t=new Array;for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function BAtos(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}function BAtohex(e){var t="";for(var n=0;n<e.length;n++){var r=e[n].toString(16);r.length==1&&(r="0"+r),t+=r}return t}function stohex(e){return BAtohex(stoBA(e))}function stob64(e){return hex2b64(stohex(e))}function stob64u(e){return b64tob64u(hex2b64(stohex(e)))}function b64utos(e){return BAtos(b64toBA(b64utob64(e)))}function b64tob64u(e){return e=e.replace(/\=/g,""),e=e.replace(/\+/g,"-"),e=e.replace(/\//g,"_"),e}function b64utob64(e){return e.length%4==2?e+="==":e.length%4==3&&(e+="="),e=e.replace(/-/g,"+"),e=e.replace(/_/g,"/"),e}function hextob64u(e){return b64tob64u(hex2b64(e))}function b64utohex(e){return b64tohex(b64utob64(e))}function utf8tob64(e){return hex2b64(uricmptohex(encodeURIComponentAll(e)))}function b64toutf8(e){return decodeURIComponent(hextouricmp(b64tohex(e)))}function utf8tohex(e){return uricmptohex(encodeURIComponentAll(e))}function hextoutf8(e){return decodeURIComponent(hextouricmp(e))}function hextorstr(e){var t="";for(var n=0;n<e.length-1;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t}function rstrtohex(e){var t="";for(var n=0;n<e.length;n++)t+=("0"+e.charCodeAt(n).toString(16)).slice(-2);return t}function hextob64(e){return hex2b64(e)}function hextob64nl(e){var t=hextob64(e),n=t.replace(/(.{64})/g,"$1\r\n");return n=n.replace(/\r\n$/,""),n}function b64nltohex(e){var t=e.replace(/[^0-9A-Za-z\/+=]*/g,""),n=b64tohex(t);return n}function uricmptohex(e){return e.replace(/%/g,"")}function hextouricmp(e){return e.replace(/(..)/g,"%$1")}function encodeURIComponentAll(e){var t=encodeURIComponent(e),n="";for(var r=0;r<t.length;r++)t[r]=="%"?(n+=t.substr(r,3),r+=2):n=n+"%"+stohex(t[r]);return n}function newline_toUnix(e){return e=e.replace(/\r\n/mg,"\n"),e}function newline_toDos(e){return e=e.replace(/\r\n/mg,"\n"),e=e.replace(/\n/mg,"\r\n"),e}var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=r.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;return t&&n.mixIn(t),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=r.WordArray=i.extend({init:function(e,n){e=this.words=e||[],n!=t?this.sigBytes=n:this.sigBytes=e.length*4},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;this.clamp();if(r%4)for(var s=0;s<i;s++){var o=n[s>>>2]>>>24-s%4*8&255;t[r+s>>>2]|=o<<24-(r+s)%4*8}else if(n.length>65535)for(var s=0;s<i;s+=4)t[r+s>>>2]=n[s>>>2];else t.push.apply(t,n);return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){var n=[];for(var r=0;r<t;r+=4)n.push(e.random()*4294967296|0);return new s.init(n,t)}}),o=n.enc={},u=o.Hex={stringify:function(e){var t=e.words,n=e.sigBytes,r=[];for(var i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((s&15).toString(16))}return r.join("")},parse:function(e){var t=e.length,n=[];for(var r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},a=o.Latin1={stringify:function(e){var t=e.words,n=e.sigBytes,r=[];for(var i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){var t=e.length,n=[];for(var r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-r%4*8;return new s.init(n,t)}},f=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,u=o*4,a=i/u;t?a=e.ceil(a):a=e.max((a|0)-this._minBufferSize,0);var f=a*o,l=e.min(f*4,i);if(f){for(var c=0;c<f;c+=o)this._doProcessBlock(r,c);var h=r.splice(0,f);n.sigBytes-=l}return new s.init(h,l)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),c=r.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return(new e.init(n)).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return(new h.HMAC.init(e,n)).finalize(t)}}}),h=n.algo={};return n}(Math);(function(){var e=CryptoJS,t=e.lib,n=t.WordArray,r=t.Hasher,i=e.algo,s=[],o=i.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){var n=this._hash.words,r=n[0],i=n[1],o=n[2],u=n[3],a=n[4];for(var f=0;f<80;f++){if(f<16)s[f]=e[t+f]|0;else{var l=s[f-3]^s[f-8]^s[f-14]^s[f-16];s[f]=l<<1|l>>>31}var c=(r<<5|r>>>27)+a+s[f];f<20?c+=(i&o|~i&u)+1518500249:f<40?c+=(i^o^u)+1859775393:f<60?c+=(i&o|i&u|o&u)-1894007588:c+=(i^o^u)-899497514,a=u,u=o,o=i<<30|i>>>2,i=r,r=c}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+u|0,n[4]=n[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,n=this._nDataBytes*8,r=e.sigBytes*8;return t[r>>>5]|=128<<24-r%32,t[(r+64>>>9<<4)+14]=Math.floor(n/4294967296),t[(r+64>>>9<<4)+15]=n,e.sigBytes=t.length*4,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=r._createHelper(o),e.HmacSHA1=r._createHmacHelper(o)})(),function(e){var t=CryptoJS,n=t.lib,r=n.WordArray,i=n.Hasher,s=t.algo,o=[],u=[];(function(){function t(t){var n=e.sqrt(t);for(var r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return(e-(e|0))*4294967296|0}var r=2,i=0;while(i<64)t(r)&&(i<8&&(o[i]=n(e.pow(r,.5))),u[i]=n(e.pow(r,1/3)),i++),r++})();var a=[],f=s.SHA256=i.extend({_doReset:function(){this._hash=new r.init(o.slice(0))},_doProcessBlock:function(e,t){var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],f=n[4],l=n[5],c=n[6],h=n[7];for(var p=0;p<64;p++){if(p<16)a[p]=e[t+p]|0;else{var d=a[p-15],v=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,m=a[p-2],g=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;a[p]=v+a[p-7]+g+a[p-16]}var y=f&l^~f&c,b=r&i^r&s^i&s,w=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),E=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),S=h+E+y+u[p]+a[p],x=w+b;h=c,c=l,l=f,f=o+S|0,o=s,s=i,i=r,r=S+x|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+f|0,n[5]=n[5]+l|0,n[6]=n[6]+c|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=this._nDataBytes*8,i=t.sigBytes*8;return n[i>>>5]|=128<<24-i%32,n[(i+64>>>9<<4)+14]=e.floor(r/4294967296),n[(i+64>>>9<<4)+15]=r,t.sigBytes=n.length*4,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(f),t.HmacSHA256=i._createHmacHelper(f)}(Math),function(e){var t=CryptoJS,n=t.lib,r=n.Base,i=n.WordArray,s=t.x64={},o=s.Word=r.extend({init:function(e,t){this.high=e,this.low=t}}),u=s.WordArray=r.extend({init:function(t,n){t=this.words=t||[],n!=e?this.sigBytes=n:this.sigBytes=t.length*8},toX32:function(){var e=this.words,t=e.length,n=[];for(var r=0;r<t;r++){var s=e[r];n.push(s.high),n.push(s.low)}return i.create(n,this.sigBytes)},clone:function(){var e=r.clone.call(this),t=e.words=this.words.slice(0),n=t.length;for(var i=0;i<n;i++)t[i]=t[i].clone();return e}})}(),function(){function u(){return i.create.apply(i,arguments)}var e=CryptoJS,t=e.lib,n=t.Hasher,r=e.x64,i=r.Word,s=r.WordArray,o=e.algo,a=[u(1116352408,3609767458),u(1899447441,602891725),u(3049323471,3964484399),u(3921009573,2173295548),u(961987163,4081628472),u(1508970993,3053834265),u(2453635748,2937671579),u(2870763221,3664609560),u(3624381080,2734883394),u(310598401,1164996542),u(607225278,1323610764),u(1426881987,3590304994),u(1925078388,4068182383),u(2162078206,991336113),u(2614888103,633803317),u(3248222580,3479774868),u(3835390401,2666613458),u(4022224774,944711139),u(264347078,2341262773),u(604807628,2007800933),u(770255983,1495990901),u(1249150122,1856431235),u(1555081692,3175218132),u(1996064986,2198950837),u(2554220882,3999719339),u(2821834349,766784016),u(2952996808,2566594879),u(3210313671,3203337956),u(3336571891,1034457026),u(3584528711,2466948901),u(113926993,3758326383),u(338241895,168717936),u(666307205,1188179964),u(773529912,1546045734),u(1294757372,1522805485),u(1396182291,2643833823),u(1695183700,2343527390),u(1986661051,1014477480),u(2177026350,1206759142),u(2456956037,344077627),u(2730485921,1290863460),u(2820302411,3158454273),u(3259730800,3505952657),u(3345764771,106217008),u(3516065817,3606008344),u(3600352804,1432725776),u(4094571909,1467031594),u(275423344,851169720),u(430227734,3100823752),u(506948616,1363258195),u(659060556,3750685593),u(883997877,3785050280),u(958139571,3318307427),u(1322822218,3812723403),u(1537002063,2003034995),u(1747873779,3602036899),u(1955562222,1575990012),u(2024104815,1125592928),u(2227730452,2716904306),u(2361852424,442776044),u(2428436474,593698344),u(2756734187,3733110249),u(3204031479,2999351573),u(3329325298,3815920427),u(3391569614,3928383900),u(3515267271,566280711),u(3940187606,3454069534),u(4118630271,4000239992),u(116418474,1914138554),u(174292421,2731055270),u(289380356,3203993006),u(460393269,320620315),u(685471733,587496836),u(852142971,1086792851),u(1017036298,365543100),u(1126000580,2618297676),u(1288033470,3409855158),u(1501505948,4234509866),u(1607167915,987167468),u(1816402316,1246189591)],f=[];(function(){for(var e=0;e<80;e++)f[e]=u()})();var l=o.SHA512=n.extend({_doReset:function(){this._hash=new s.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],l=n[5],c=n[6],h=n[7],p=r.high,d=r.low,v=i.high,m=i.low,g=s.high,y=s.low,b=o.high,w=o.low,E=u.high,S=u.low,x=l.high,T=l.low,N=c.high,C=c.low,k=h.high,L=h.low,A=p,O=d,M=v,_=m,D=g,P=y,H=b,B=w,j=E,F=S,I=x,q=T,R=N,U=C,z=k,X=L;for(var V=0;V<80;V++){var $=f[V];if(V<16)var J=$.high=e[t+V*2]|0,Q=$.low=e[t+V*2+1]|0;else{var G=f[V-15],Y=G.high,Z=G.low,et=(Y>>>1|Z<<31)^(Y>>>8|Z<<24)^Y>>>7,tt=(Z>>>1|Y<<31)^(Z>>>8|Y<<24)^(Z>>>7|Y<<25),nt=f[V-2],rt=nt.high,it=nt.low,st=(rt>>>19|it<<13)^(rt<<3|it>>>29)^rt>>>6,ot=(it>>>19|rt<<13)^(it<<3|rt>>>29)^(it>>>6|rt<<26),ut=f[V-7],at=ut.high,ft=ut.low,lt=f[V-16],ct=lt.high,ht=lt.low,Q=tt+ft,J=et+at+(Q>>>0<tt>>>0?1:0),Q=Q+ot,J=J+st+(Q>>>0<ot>>>0?1:0),Q=Q+ht,J=J+ct+(Q>>>0<ht>>>0?1:0);$.high=J,$.low=Q}var pt=j&I^~j&R,dt=F&q^~F&U,vt=A&M^A&D^M&D,mt=O&_^O&P^_&P,gt=(A>>>28|O<<4)^(A<<30|O>>>2)^(A<<25|O>>>7),yt=(O>>>28|A<<4)^(O<<30|A>>>2)^(O<<25|A>>>7),bt=(j>>>14|F<<18)^(j>>>18|F<<14)^(j<<23|F>>>9),wt=(F>>>14|j<<18)^(F>>>18|j<<14)^(F<<23|j>>>9),Et=a[V],St=Et.high,xt=Et.low,Tt=X+wt,Nt=z+bt+(Tt>>>0<X>>>0?1:0),Tt=Tt+dt,Nt=Nt+pt+(Tt>>>0<dt>>>0?1:0),Tt=Tt+xt,Nt=Nt+St+(Tt>>>0<xt>>>0?1:0),Tt=Tt+Q,Nt=Nt+J+(Tt>>>0<Q>>>0?1:0),Ct=yt+mt,kt=gt+vt+(Ct>>>0<yt>>>0?1:0);z=R,X=U,R=I,U=q,I=j,q=F,F=B+Tt|0,j=H+Nt+(F>>>0<B>>>0?1:0)|0,H=D,B=P,D=M,P=_,M=A,_=O,O=Tt+Ct|0,A=Nt+kt+(O>>>0<Tt>>>0?1:0)|0}d=r.low=d+O,r.high=p+A+(d>>>0<O>>>0?1:0),m=i.low=m+_,i.high=v+M+(m>>>0<_>>>0?1:0),y=s.low=y+P,s.high=g+D+(y>>>0<P>>>0?1:0),w=o.low=w+B,o.high=b+H+(w>>>0<B>>>0?1:0),S=u.low=S+F,u.high=E+j+(S>>>0<F>>>0?1:0),T=l.low=T+q,l.high=x+I+(T>>>0<q>>>0?1:0),C=c.low=C+U,c.high=N+R+(C>>>0<U>>>0?1:0),L=h.low=L+X,h.high=k+z+(L>>>0<X>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=this._nDataBytes*8,r=e.sigBytes*8;t[r>>>5]|=128<<24-r%32,t[(r+128>>>10<<5)+30]=Math.floor(n/4294967296),t[(r+128>>>10<<5)+31]=n,e.sigBytes=t.length*4,this._process();var i=this._hash.toX32();return i},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=n._createHelper(l),e.HmacSHA512=n._createHmacHelper(l)}(),define("third-party-libs/crypto.js",function(){}),function(){"use strict";function e(e){return typeof e=="function"||typeof e=="object"&&e!==null}function t(e){return typeof e=="function"}function n(e){return typeof e=="object"&&e!==null}function o(){}function p(){return function(){process.nextTick(y)}}function d(){var e=0,t=new c(y),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function v(){var e=new MessageChannel;return e.port1.onmessage=y,function(){e.port2.postMessage(0)}}function m(){return function(){setTimeout(y,1)}}function y(){for(var e=0;e<a;e+=2){var t=g[e],n=g[e+1];t(n),g[e]=undefined,g[e+1]=undefined}a=0}function w(){}function N(){return new TypeError("You cannot resolve a promise with itself")}function C(){return new TypeError("A promises callback cannot return that same promise.")}function k(e){try{return e.then}catch(t){return T.error=t,T}}function L(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function A(e,t,n){f(function(e){var r=!1,i=L(n,t,function(n){if(r)return;r=!0,t!==n?_(e,n):P(e,n)},function(t){if(r)return;r=!0,H(e,t)},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,H(e,i))},e)}function O(e,t){t._state===S?P(e,t._result):e._state===x?H(e,t._result):B(t,undefined,function(t){_(e,t)},function(t){H(e,t)})}function M(e,n){if(n.constructor===e.constructor)O(e,n);else{var r=k(n);r===T?H(e,T.error):r===undefined?P(e,n):t(r)?A(e,n,r):P(e,n)}}function _(t,n){t===n?H(t,N()):e(n)?M(t,n):P(t,n)}function D(e){e._onerror&&e._onerror(e._result),j(e)}function P(e,t){if(e._state!==E)return;e._result=t,e._state=S,e._subscribers.length!==0&&f(j,e)}function H(e,t){if(e._state!==E)return;e._state=x,e._result=t,f(D,e)}function B(e,t,n,r){var i=e._subscribers,s=i.length;e._onerror=null,i[s]=t,i[s+S]=n,i[s+x]=r,s===0&&e._state&&f(j,e)}function j(e){var t=e._subscribers,n=e._state;if(t.length===0)return;var r,i,s=e._result;for(var o=0;o<t.length;o+=3)r=t[o],i=t[o+n],r?R(n,r,i,s):i(s);e._subscribers.length=0}function F(){this.error=null}function q(e,t){try{return e(t)}catch(n){return I.error=n,I}}function R(e,n,r,i){var s=t(r),o,u,a,f;if(s){o=q(r,i),o===I?(f=!0,u=o.error,o=null):a=!0;if(n===o){H(n,C());return}}else o=i,a=!0;n._state===E&&(s&&a?_(n,o):f?H(n,u):e===S?P(n,o):e===x&&H(n,o))}function U(e,t){try{t(function(n){_(e,n)},function(n){H(e,n)})}catch(n){H(e,n)}}function z(e,t,n){return e===S?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function W(e,t,n,r){this._instanceConstructor=e,this.promise=new e(w,r),this._abortOnReject=n,this._validateInput(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._init(),this.length===0?P(this.promise,this._result):(this.length=this.length||0,this._enumerate(),this._remaining===0&&P(this.promise,this._result))):H(this.promise,this._validationError())}function G(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Y(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function et(e,n){this._id=Q++,this._label=n,this._state=undefined,this._result=undefined,this._subscribers=[],w!==e&&(t(e)||G(),this instanceof et||Y(),U(this,e))}var r;Array.isArray?r=Array.isArray:r=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var i=r,s=Date.now||function(){return(new Date).getTime()},u=Object.create||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if(typeof e!="object")throw new TypeError("Argument must be an object");return o.prototype=e,new o},a=0,f=function(t,n){g[a]=t,g[a+1]=n,a+=2,a===2&&b()},l=typeof window!="undefined"?window:{},c=l.MutationObserver||l.WebKitMutationObserver,h=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined",g=new Array(1e3),b;typeof process!="undefined"&&{}.toString.call(process)==="[object process]"?b=p():c?b=d():h?b=v():b=m();var E=void 0,S=1,x=2,T=new F,I=new F;W.prototype._validateInput=function(e){return i(e)},W.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},W.prototype._init=function(){this._result=new Array(this.length)};var X=W;W.prototype._enumerate=function(){var e=this.length,t=this.promise,n=this._input;for(var r=0;t._state===E&&r<e;r++)this._eachEntry(n[r],r)},W.prototype._eachEntry=function(e,t){var r=this._instanceConstructor;n(e)?e.constructor===r&&e._state!==E?(e._onerror=null,this._settledAt(e._state,t,e._result)):this._willSettleAt(r.resolve(e),t):(this._remaining--,this._result[t]=this._makeResult(S,t,e))},W.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===E&&(this._remaining--,this._abortOnReject&&e===x?H(r,n):this._result[t]=this._makeResult(e,t,n)),this._remaining===0&&P(r,this._result)},W.prototype._makeResult=function(e,t,n){return n},W.prototype._willSettleAt=function(e,t){var n=this;B(e,undefined,function(e){n._settledAt(S,t,e)},function(e){n._settledAt(x,t,e)})};var V=function(t,n){return(new X(this,t,!0,n)).promise},$=function(t,n){function u(e){_(s,e)}function a(e){H(s,e)}var r=this,s=new r(w,n);if(!i(t))return H(s,new TypeError("You must pass an array to race.")),s;var o=t.length;for(var f=0;s._state===E&&f<o;f++)B(r.resolve(t[f]),undefined,u,a);return s},J=function(t,n){var r=this;if(t&&typeof t=="object"&&t.constructor===r)return t;var i=new r(w,n);return _(i,t),i},K=function(t,n){var r=this,i=new r(w,n);return H(i,t),i},Q=0,Z=et;et.all=V,et.race=$,et.resolve=J,et.reject=K,et.prototype={constructor:et,then:function(e,t,n){var r=this,i=r._state;if(i===S&&!e||i===x&&!t)return this;r._onerror=null;var s=new this.constructor(w,n),o=r._result;if(i){var u=arguments[i-1];f(function(){R(i,s,u,o)})}else B(r,s,e,t);return s},"catch":function(e,t){return this.then(null,e,t)}};var tt=function(){var n;typeof global!="undefined"?n=global:typeof window!="undefined"&&window.document?n=window:n=self;var r="Promise"in n&&"resolve"in n.Promise&&"reject"in n.Promise&&"all"in n.Promise&&"race"in n.Promise&&function(){var e;return new n.Promise(function(t){e=t}),t(e)}();r||(n.Promise=Z)},nt={Promise:Z,polyfill:tt};typeof define=="function"&&define.amd?define("third-party-libs/es6-promise-2.0.0.js",[],function(){return nt}):typeof module!="undefined"&&module.exports?module.exports=nt:typeof this!="undefined"&&(this.ES6Promise=nt),window.Promise=window.Promise||nt.Promise}.call(this);var jsonParse=function(){function o(e,t,n){return t?s[t]:String.fromCharCode(parseInt(n,16))}var e="(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)",t='(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))',n='(?:"'+t+'*")',r=new RegExp("(?:false|true|null|[\\{\\}\\[\\]]|"+e+"|"+n+")","g"),i=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),s={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},u=new String(""),a="\\",f={"{":Object,"[":Array},l=Object.hasOwnProperty;return function(e,t){var n=e.match(r),s,f=n[0],c=!1;"{"===f?s={}:"["===f?s=[]:(s=[],c=!0);var h,p=[s];for(var d=1-c,v=n.length;d<v;++d){f=n[d];var m;switch(f.charCodeAt(0)){default:m=p[0],m[h||m.length]=+f,h=void 0;break;case 34:f=f.substring(1,f.length-1),f.indexOf(a)!==-1&&(f=f.replace(i,o)),m=p[0];if(!h){if(!(m instanceof Array)){h=f||u;break}h=m.length}m[h]=f,h=void 0;break;case 91:m=p[0],p.unshift(m[h||m.length]=[]),h=void 0;break;case 93:p.shift();break;case 102:m=p[0],m[h||m.length]=!1,h=void 0;break;case 110:m=p[0],m[h||m.length]=null,h=void 0;break;case 116:m=p[0],m[h||m.length]=!0,h=void 0;break;case 123:m=p[0],p.unshift(m[h||m.length]={}),h=void 0;break;case 125:p.shift()}}if(c){if(p.length!==1)throw new Error;s=s[0]}else if(p.length)throw new Error;if(t){var g=function(e,n){var r=e[n];if(r&&typeof r=="object"){var i=null;for(var s in r)if(l.call(r,s)&&r!==e){var o=g(r,s);o!==void 0?r[s]=o:(i||(i=[]),i.push(s))}if(i)for(var u=i.length;--u>=0;)delete r[i[u]]}return t.call(e,n,r)};s=g({"":s},"")}return s}}();define("third-party-libs/json-sans-eval.js",function(){});if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.jws=="undefined"||!KJUR.jws)KJUR.jws={};KJUR.jws.JWS=function(){function e(e,t){return utf8tob64u(e)+"."+utf8tob64u(t)}function t(e,t){var n=function(e){return KJUR.crypto.Util.hashString(e,t)};if(n==null)throw"hash function not defined in jsrsasign: "+t;return n(e)}function n(t,n,r,i,s){var o=e(t,n),u=parseBigInt(r,16);return _rsasign_verifySignatureWithArgs(o,u,i,s)}function r(e){var t=e.alg,n="";if(t!="RS256"&&t!="RS512"&&t!="PS256"&&t!="PS512")throw"JWS signature algorithm not supported: "+t;return t.substr(2)=="256"&&(n="sha256"),t.substr(2)=="512"&&(n="sha512"),n}function i(e){return r(jsonParse(e))}function s(e,t,n,r,s,o){var u=new RSAKey;u.setPrivate(r,s,o);var a=i(e),f=u.signString(n,a);return f}function o(e,t,n,s,o){var u=null;typeof o=="undefined"?u=i(e):u=r(o);var a=o["alg"].substr(0,2)=="PS";return s.hashAndSign?b64tob64u(s.hashAndSign(u,n,"binary","base64",a)):a?hextob64u(s.signStringPSS(n,u)):hextob64u(s.signString(n,u))}function u(t,n,r,i,o){var u=e(t,n);return s(t,n,u,r,i,o)}function a(e,t,n,r){var s=new RSAKey;s.readPrivateKeyFromPEMString(r);var o=i(e),u=s.signString(n,o);return u}this.parseJWS=function(e,t){if(!(this.parsedJWS===undefined||!t&&this.parsedJWS.sigvalH===undefined))return;if(e.match(/^([^.]+)\.([^.]+)\.([^.]+)$/)==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var n=RegExp.$1,r=RegExp.$2,i=RegExp.$3,s=n+"."+r;this.parsedJWS={},this.parsedJWS.headB64U=n,this.parsedJWS.payloadB64U=r,this.parsedJWS.sigvalB64U=i,this.parsedJWS.si=s;if(!t){var o=b64utohex(i),u=parseBigInt(o,16);this.parsedJWS.sigvalH=o,this.parsedJWS.sigvalBI=u}var a=b64utoutf8(n),f=b64utoutf8(r);this.parsedJWS.headS=a,this.parsedJWS.payloadS=f;if(!KJUR.jws.JWS.isSafeJSONString(a,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+a},this.verifyJWSByNE=function(e,t,n){return this.parseJWS(e),_rsasign_verifySignatureWithArgs(this.parsedJWS.si,this.parsedJWS.sigvalBI,t,n)},this.verifyJWSByKey=function(e,t){this.parseJWS(e);var n=r(this.parsedJWS.headP),i=this.parsedJWS.headP["alg"].substr(0,2)=="PS";return t.hashAndVerify?t.hashAndVerify(n,(new Buffer(this.parsedJWS.si,"utf8")).toString("base64"),b64utob64(this.parsedJWS.sigvalB64U),"base64",i):i?t.verifyStringPSS(this.parsedJWS.si,this.parsedJWS.sigvalH,n):t.verifyString(this.parsedJWS.si,this.parsedJWS.sigvalH)},this.verifyJWSByPemX509Cert=function(e,t){this.parseJWS(e);var n=new X509;return n.readCertPEM(t),n.subjectPublicKeyRSA.verifyString(this.parsedJWS.si,this.parsedJWS.sigvalH)},this.generateJWSByNED=function(t,n,r,i,o){if(!KJUR.jws.JWS.isSafeJSONString(t))throw"JWS Head is not safe JSON string: "+t;var u=e(t,n),a=s(t,n,u,r,i,o),f=hextob64u(a);return this.parsedJWS={},this.parsedJWS.headB64U=u.split(".")[0],this.parsedJWS.payloadB64U=u.split(".")[1],this.parsedJWS.sigvalB64U=f,u+"."+f},this.generateJWSByKey=function(t,n,r){var i={};if(!KJUR.jws.JWS.isSafeJSONString(t,i,"headP"))throw"JWS Head is not safe JSON string: "+t;var s=e(t,n),u=o(t,n,s,r,i.headP);return this.parsedJWS={},this.parsedJWS.headB64U=s.split(".")[0],this.parsedJWS.payloadB64U=s.split(".")[1],this.parsedJWS.sigvalB64U=u,s+"."+u},this.generateJWSByP1PrvKey=function(t,n,r){if(!KJUR.jws.JWS.isSafeJSONString(t))throw"JWS Head is not safe JSON string: "+t;var i=e(t,n),s=a(t,n,i,r),o=hextob64u(s);return this.parsedJWS={},this.parsedJWS.headB64U=i.split(".")[0],this.parsedJWS.payloadB64U=i.split(".")[1],this.parsedJWS.sigvalB64U=o,i+"."+o}},KJUR.jws.JWS.sign=function(e,t,n,r,i){var s=KJUR.jws.JWS;if(!s.isSafeJSONString(t))throw"JWS Head is not safe JSON string: "+sHead;var o=s.readSafeJSONString(t);(e==""||e==null)&&o.alg!==undefined&&(e=o.alg),e!=""&&e!=null&&o.alg===undefined&&(o.alg=e,t=JSON.stringify(o));var u=null;if(s.jwsalg2sigalg[e]===undefined)throw"unsupported alg name: "+e;u=s.jwsalg2sigalg[e];var a=utf8tob64u(t),f=utf8tob64u(n),l=a+"."+f,c="";if(u.substr(0,4)=="Hmac"){if(r===undefined)throw"hexadecimal key shall be specified for HMAC";var h=new KJUR.crypto.Mac({alg:u,pass:hextorstr(r)});h.updateString(l),c=h.doFinal()}else if(u.indexOf("withECDSA")!=-1){var p=new KJUR.crypto.Signature({alg:u});p.init(r,i),p.updateString(l),hASN1Sig=p.sign(),c=KJUR.crypto.ECDSA.asn1SigToConcatSig(hASN1Sig)}else if(u!="none"){var p=new KJUR.crypto.Signature({alg:u});p.init(r,i),p.updateString(l),c=p.sign()}var d=hextob64u(c);return l+"."+d},KJUR.jws.JWS.verify=function(e,t){var n=KJUR.jws.JWS,r=e.split("."),i=r[0],s=r[1],o=i+"."+s,u=b64utohex(r[2]),a=n.readSafeJSONString(b64utoutf8(r[0])),f=null;if(a.alg===undefined)throw"algorithm not specified in header";f=a.alg;var l=null;if(n.jwsalg2sigalg[a.alg]===undefined)throw"unsupported alg name: "+f;l=n.jwsalg2sigalg[f];if(l=="none")return!0;if(l.substr(0,4)=="Hmac"){if(t===undefined)throw"hexadecimal key shall be specified for HMAC";var c=new KJUR.crypto.Mac({alg:l,pass:hextorstr(t)});return c.updateString(o),hSig2=c.doFinal(),u==hSig2}if(l.indexOf("withECDSA")!=-1){var h=null;try{h=KJUR.crypto.ECDSA.concatSigToASN1Sig(u)}catch(p){return!1}var d=new KJUR.crypto.Signature({alg:l});return d.init(t),d.updateString(o),d.verify(h)}var d=new KJUR.crypto.Signature({alg:l});return d.init(t),d.updateString(o),d.verify(u)},KJUR.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},KJUR.jws.JWS.isSafeJSONString=function(e,t,n){var r=null;try{return r=jsonParse(e),typeof r!="object"?0:r.constructor===Array?0:(t&&(t[n]=r),1)}catch(i){return 0}},KJUR.jws.JWS.readSafeJSONString=function(e){var t=null;try{return t=jsonParse(e),typeof t!="object"?null:t.constructor===Array?null:t}catch(n){return null}},KJUR.jws.JWS.getEncodedSignatureValueFromJWS=function(e){if(e.match(/^[^.]+\.[^.]+\.([^.]+)$/)==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return RegExp.$1},KJUR.jws.IntDate=function(){},KJUR.jws.IntDate.get=function(e){if(e=="now")return KJUR.jws.IntDate.getNow();if(e=="now + 1hour")return KJUR.jws.IntDate.getNow()+3600;if(e=="now + 1day")return KJUR.jws.IntDate.getNow()+86400;if(e=="now + 1month")return KJUR.jws.IntDate.getNow()+2592e3;if(e=="now + 1year")return KJUR.jws.IntDate.getNow()+31536e3;if(e.match(/Z$/))return KJUR.jws.IntDate.getZulu(e);if(e.match(/^[0-9]+$/))return parseInt(e);throw"unsupported format: "+e},KJUR.jws.IntDate.getZulu=function(e){if(a=e.match(/(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z/)){var t=parseInt(RegExp.$1),n=parseInt(RegExp.$2)-1,r=parseInt(RegExp.$3),i=parseInt(RegExp.$4),s=parseInt(RegExp.$5),o=parseInt(RegExp.$6),u=new Date(Date.UTC(t,n,r,i,s,o));return~~(u/1e3)}throw"unsupported format: "+e},KJUR.jws.IntDate.getNow=function(){var e=~~(new Date/1e3);return e},KJUR.jws.IntDate.intDate2UTCString=function(e){var t=new Date(e*1e3);return t.toUTCString()},KJUR.jws.IntDate.intDate2Zulu=function(e){var t=new Date(e*1e3),n=("0000"+t.getUTCFullYear()).slice(-4),r=("00"+(t.getUTCMonth()+1)).slice(-2),i=("00"+t.getUTCDate()).slice(-2),s=("00"+t.getUTCHours()).slice(-2),o=("00"+t.getUTCMinutes()).slice(-2),u=("00"+t.getUTCSeconds()).slice(-2);return n+r+i+s+o+u+"Z"},define("third-party-libs/jws-3.0.js",function(){});var b64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64pad="=",dbits,canary=0xdeadbeefcafe,j_lm=(canary&16777215)==15715070;j_lm&&navigator.appName=="Microsoft Internet Explorer"?(BigInteger.prototype.am=am2,dbits=30):j_lm&&navigator.appName!="Netscape"?(BigInteger.prototype.am=am1,dbits=26):(BigInteger.prototype.am=am3,dbits=28),BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP),BigInteger.prototype.F1=BI_FP-dbits,BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.isEven=bnpIsEven,BigInteger.prototype.exp=bnpExp,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.modPowInt=bnModPowInt,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=nMulTo,NullExp.prototype.sqrTo=nSqrTo,Barrett.prototype.convert=barrettConvert,Barrett.prototype.revert=barrettRevert,Barrett.prototype.reduce=barrettReduce,Barrett.prototype.mulTo=barrettMulTo,Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];BigInteger.prototype.chunkSize=bnpChunkSize,BigInteger.prototype.toRadix=bnpToRadix,BigInteger.prototype.fromRadix=bnpFromRadix,BigInteger.prototype.fromNumber=bnpFromNumber,BigInteger.prototype.bitwiseTo=bnpBitwiseTo,BigInteger.prototype.changeBit=bnpChangeBit,BigInteger.prototype.addTo=bnpAddTo,BigInteger.prototype.dMultiply=bnpDMultiply,BigInteger.prototype.dAddOffset=bnpDAddOffset,BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo,BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo,BigInteger.prototype.modInt=bnpModInt,BigInteger.prototype.millerRabin=bnpMillerRabin,BigInteger.prototype.clone=bnClone,BigInteger.prototype.intValue=bnIntValue,BigInteger.prototype.byteValue=bnByteValue,BigInteger.prototype.shortValue=bnShortValue,BigInteger.prototype.signum=bnSigNum,BigInteger.prototype.toByteArray=bnToByteArray,BigInteger.prototype.equals=bnEquals,BigInteger.prototype.min=bnMin,BigInteger.prototype.max=bnMax,BigInteger.prototype.and=bnAnd,BigInteger.prototype.or=bnOr,BigInteger.prototype.xor=bnXor,BigInteger.prototype.andNot=bnAndNot,BigInteger.prototype.not=bnNot,BigInteger.prototype.shiftLeft=bnShiftLeft,BigInteger.prototype.shiftRight=bnShiftRight,BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit,BigInteger.prototype.bitCount=bnBitCount,BigInteger.prototype.testBit=bnTestBit,BigInteger.prototype.setBit=bnSetBit,BigInteger.prototype.clearBit=bnClearBit,BigInteger.prototype.flipBit=bnFlipBit,BigInteger.prototype.add=bnAdd,BigInteger.prototype.subtract=bnSubtract,BigInteger.prototype.multiply=bnMultiply,BigInteger.prototype.divide=bnDivide,BigInteger.prototype.remainder=bnRemainder,BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder,BigInteger.prototype.modPow=bnModPow,BigInteger.prototype.modInverse=bnModInverse,BigInteger.prototype.pow=bnPow,BigInteger.prototype.gcd=bnGCD,BigInteger.prototype.isProbablePrime=bnIsProbablePrime,BigInteger.prototype.square=bnSquare;var SHA1_SIZE=20;RSAKey.prototype.doPublic=RSADoPublic,RSAKey.prototype.setPublic=RSASetPublic,RSAKey.prototype.encrypt=RSAEncrypt,RSAKey.prototype.encryptOAEP=RSAEncryptOAEP,RSAKey.prototype.type="RSA";var SHA1_SIZE=20;RSAKey.prototype.doPrivate=RSADoPrivate,RSAKey.prototype.setPrivate=RSASetPrivate,RSAKey.prototype.setPrivateEx=RSASetPrivateEx,RSAKey.prototype.generate=RSAGenerate,RSAKey.prototype.decrypt=RSADecrypt,RSAKey.prototype.decryptOAEP=RSADecryptOAEP,RSAKey.prototype.readPrivateKeyFromPEMString=_rsapem_readPrivateKeyFromPEMString,RSAKey.prototype.readPrivateKeyFromASN1HexString=_rsapem_readPrivateKeyFromASN1HexString;var _RE_HEXDECONLY=new RegExp("");_RE_HEXDECONLY.compile("[^0-9a-f]","gi"),RSAKey.prototype.signWithMessageHash=_rsasign_signWithMessageHash,RSAKey.prototype.signString=_rsasign_signString,RSAKey.prototype.signStringWithSHA1=_rsasign_signStringWithSHA1,RSAKey.prototype.signStringWithSHA256=_rsasign_signStringWithSHA256,RSAKey.prototype.sign=_rsasign_signString,RSAKey.prototype.signWithSHA1=_rsasign_signStringWithSHA1,RSAKey.prototype.signWithSHA256=_rsasign_signStringWithSHA256,RSAKey.prototype.signWithMessageHashPSS=_rsasign_signWithMessageHashPSS,RSAKey.prototype.signStringPSS=_rsasign_signStringPSS,RSAKey.prototype.signPSS=_rsasign_signStringPSS,RSAKey.SALT_LEN_HLEN=-1,RSAKey.SALT_LEN_MAX=-2,RSAKey.prototype.verifyWithMessageHash=_rsasign_verifyWithMessageHash,RSAKey.prototype.verifyString=_rsasign_verifyString,RSAKey.prototype.verifyHexSignatureForMessage=_rsasign_verifyHexSignatureForMessage,RSAKey.prototype.verify=_rsasign_verifyString,RSAKey.prototype.verifyHexSignatureForByteArrayMessage=_rsasign_verifyHexSignatureForMessage,RSAKey.prototype.verifyWithMessageHashPSS=_rsasign_verifyWithMessageHashPSS,RSAKey.prototype.verifyStringPSS=_rsasign_verifyStringPSS,RSAKey.prototype.verifyPSS=_rsasign_verifyStringPSS,RSAKey.SALT_LEN_RECOVER=-2;var ASN1HEX=new function(){this.getByteLengthOfL_AtObj=function(e,t){if(e.substring(t+2,t+3)!="8")return 1;var n=parseInt(e.substring(t+3,t+4));return n==0?-1:0<n&&n<10?n+1:-2},this.getHexOfL_AtObj=function(e,t){var n=this.getByteLengthOfL_AtObj(e,t);return n<1?"":e.substring(t+2,t+2+n*2)},this.getIntOfL_AtObj=function(e,t){var n=this.getHexOfL_AtObj(e,t);if(n=="")return-1;var r;return parseInt(n.substring(0,1))<8?r=new BigInteger(n,16):r=new BigInteger(n.substring(2),16),r.intValue()},this.getStartPosOfV_AtObj=function(e,t){var n=this.getByteLengthOfL_AtObj(e,t);return n<0?n:t+(n+1)*2},this.getHexOfV_AtObj=function(e,t){var n=this.getStartPosOfV_AtObj(e,t),r=this.getIntOfL_AtObj(e,t);return e.substring(n,n+r*2)},this.getHexOfTLV_AtObj=function(e,t){var n=e.substr(t,2),r=this.getHexOfL_AtObj(e,t),i=this.getHexOfV_AtObj(e,t);return n+r+i},this.getPosOfNextSibling_AtObj=function(e,t){var n=this.getStartPosOfV_AtObj(e,t),r=this.getIntOfL_AtObj(e,t);return n+r*2},this.getPosArrayOfChildren_AtObj=function(e,t){var n=new Array,r=this.getStartPosOfV_AtObj(e,t);n.push(r);var i=this.getIntOfL_AtObj(e,t),s=r,o=0;for(;;){var u=this.getPosOfNextSibling_AtObj(e,s);if(u==null||u-r>=i*2)break;if(o>=200)break;n.push(u),s=u,o++}return n},this.getNthChildIndex_AtObj=function(e,t,n){var r=this.getPosArrayOfChildren_AtObj(e,t);return r[n]},this.getDecendantIndexByNthList=function(e,t,n){if(n.length==0)return t;var r=n.shift(),i=this.getPosArrayOfChildren_AtObj(e,t);return this.getDecendantIndexByNthList(e,i[r],n)},this.getDecendantHexTLVByNthList=function(e,t,n){var r=this.getDecendantIndexByNthList(e,t,n);return this.getHexOfTLV_AtObj(e,r)},this.getDecendantHexVByNthList=function(e,t,n){var r=this.getDecendantIndexByNthList(e,t,n);return this.getHexOfV_AtObj(e,r)}};ASN1HEX.getVbyList=function(e,t,n,r){var i=this.getDecendantIndexByNthList(e,t,n);if(i===undefined)throw"can't find nthList object";if(r!==undefined&&e.substr(i,2)!=r)throw"checking tag doesn't match: "+e.substr(i,2)+"!="+r;return this.getHexOfV_AtObj(e,i)},ASN1HEX.hextooidstr=function(e){var t=function(e,t){return e.length>=t?e:(new Array(t-e.length+1)).join("0")+e},n=[],r=e.substr(0,2),i=parseInt(r,16);n[0]=new String(Math.floor(i/40)),n[1]=new String(i%40);var s=e.substr(2),o=[];for(var u=0;u<s.length/2;u++)o.push(parseInt(s.substr(u*2,2),16));var a=[],f="";for(var u=0;u<o.length;u++)o[u]&128?f+=t((o[u]&127).toString(2),7):(f+=t((o[u]&127).toString(2),7),a.push(new String(parseInt(f,2))),f="");var l=n.join(".");return a.length>0&&(l=l+"."+a.join(".")),l},X509.pemToBase64=function(e){var t=e;return t=t.replace("-----BEGIN CERTIFICATE-----",""),t=t.replace("-----END CERTIFICATE-----",""),t=t.replace(/[ \n]+/g,""),t},X509.pemToHex=function(e){var t=X509.pemToBase64(e),n=b64tohex(t);return n},X509.getSubjectPublicKeyPosFromCertHex=function(e){var t=X509.getSubjectPublicKeyInfoPosFromCertHex(e);if(t==-1)return-1;var n=ASN1HEX.getPosArrayOfChildren_AtObj(e,t);if(n.length!=2)return-1;var r=n[1];if(e.substring(r,r+2)!="03")return-1;var i=ASN1HEX.getStartPosOfV_AtObj(e,r);return e.substring(i,i+2)!="00"?-1:i+2},X509.getSubjectPublicKeyInfoPosFromCertHex=function(e){var t=ASN1HEX.getStartPosOfV_AtObj(e,0),n=ASN1HEX.getPosArrayOfChildren_AtObj(e,t);return n.length<1?-1:e.substring(n[0],n[0]+10)=="a003020102"?n.length<6?-1:n[6]:n.length<5?-1:n[5]},X509.getPublicKeyHexArrayFromCertHex=function(e){var t=X509.getSubjectPublicKeyPosFromCertHex(e),n=ASN1HEX.getPosArrayOfChildren_AtObj(e,t);if(n.length!=2)return[];var r=ASN1HEX.getHexOfV_AtObj(e,n[0]),i=ASN1HEX.getHexOfV_AtObj(e,n[1]);return r!=null&&i!=null?[r,i]:[]},X509.getHexTbsCertificateFromCert=function(e){var t=ASN1HEX.getStartPosOfV_AtObj(e,0);return t},X509.getPublicKeyHexArrayFromCertPEM=function(e){var t=X509.pemToHex(e),n=X509.getPublicKeyHexArrayFromCertHex(t);return n},X509.hex2dn=function(e){var t="",n=ASN1HEX.getPosArrayOfChildren_AtObj(e,0);for(var r=0;r<n.length;r++){var i=ASN1HEX.getHexOfTLV_AtObj(e,n[r]);t=t+"/"+X509.hex2rdn(i)}return t},X509.hex2rdn=function(e){var t=ASN1HEX.getDecendantHexTLVByNthList(e,0,[0,0]),n=ASN1HEX.getDecendantHexVByNthList(e,0,[0,1]),r="";try{r=X509.DN_ATTRHEX[t]}catch(i){r=t}n=n.replace(/(..)/g,"%$1");var s=decodeURIComponent(n);return r+"="+s},X509.DN_ATTRHEX={"0603550406":"C","060355040a":"O","060355040b":"OU","0603550403":"CN","0603550405":"SN","0603550408":"ST","0603550407":"L"},X509.getPublicKeyFromCertPEM=function(e){var t=X509.getPublicKeyInfoPropOfCertPEM(e);if(t.algoid=="2a864886f70d010101"){var n=KEYUTIL.parsePublicRawRSAKeyHex(t.keyhex),r=new RSAKey;return r.setPublic(n.n,n.e),r}if(t.algoid=="2a8648ce3d0201"){var i=KJUR.crypto.OID.oidhex2name[t.algparam],r=new KJUR.crypto.ECDSA({curve:i,info:t.keyhex});return r.setPublicKeyHex(t.keyhex),r}if(t.algoid=="2a8648ce380401"){var s=ASN1HEX.getVbyList(t.algparam,0,[0],"02"),o=ASN1HEX.getVbyList(t.algparam,0,[1],"02"),u=ASN1HEX.getVbyList(t.algparam,0,[2],"02"),a=ASN1HEX.getHexOfV_AtObj(t.keyhex,0);a=a.substr(2);var r=new KJUR.crypto.DSA;return r.setPublic(new BigInteger(s,16),new BigInteger(o,16),new BigInteger(u,16),new BigInteger(a,16)),r}throw"unsupported key"},X509.getPublicKeyInfoPropOfCertPEM=function(e){var t={};t.algparam=null;var n=X509.pemToHex(e),r=ASN1HEX.getPosArrayOfChildren_AtObj(n,0);if(r.length!=3)throw"malformed X.509 certificate PEM (code:001)";if(n.substr(r[0],2)!="30")throw"malformed X.509 certificate PEM (code:002)";var i=ASN1HEX.getPosArrayOfChildren_AtObj(n,r[0]);if(i.length<7)throw"malformed X.509 certificate PEM (code:003)";var s=ASN1HEX.getPosArrayOfChildren_AtObj(n,i[6]);if(s.length!=2)throw"malformed X.509 certificate PEM (code:004)";var o=ASN1HEX.getPosArrayOfChildren_AtObj(n,s[0]);if(o.length!=2)throw"malformed X.509 certificate PEM (code:005)";t.algoid=ASN1HEX.getHexOfV_AtObj(n,o[0]),n.substr(o[1],2)=="06"?t.algparam=ASN1HEX.getHexOfV_AtObj(n,o[1]):n.substr(o[1],2)=="30"&&(t.algparam=ASN1HEX.getHexOfTLV_AtObj(n,o[1]));if(n.substr(s[1],2)!="03")throw"malformed X.509 certificate PEM (code:006)";var u=ASN1HEX.getHexOfV_AtObj(n,s[1]);return t.keyhex=u.substr(2),t};if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.crypto=="undefined"||!KJUR.crypto)KJUR.crypto={};KJUR.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:"CryptoJS.algo.MD5",sha1:"CryptoJS.algo.SHA1",sha224:"CryptoJS.algo.SHA224",sha256:"CryptoJS.algo.SHA256",sha384:"CryptoJS.algo.SHA384",sha512:"CryptoJS.algo.SHA512",ripemd160:"CryptoJS.algo.RIPEMD160"},this.getDigestInfoHex=function(e,t){if(typeof this.DIGESTINFOHEAD[t]=="undefined")throw"alg not supported in Util.DIGESTINFOHEAD: "+t;return this.DIGESTINFOHEAD[t]+e},this.getPaddedDigestInfoHex=function(e,t,n){var r=this.getDigestInfoHex(e,t),i=n/4;if(r.length+22>i)throw"key is too short for SigAlg: keylen="+n+","+t;var s="0001",o="00"+r,u="",a=i-s.length-o.length;for(var f=0;f<a;f+=2)u+="ff";var l=s+u+o;return l},this.hashString=function(e,t){var n=new KJUR.crypto.MessageDigest({alg:t});return n.digestString(e)},this.hashHex=function(e,t){var n=new KJUR.crypto.MessageDigest({alg:t});return n.digestHex(e)},this.sha1=function(e){var t=new KJUR.crypto.MessageDigest({alg:"sha1",prov:"cryptojs"});return t.digestString(e)},this.sha256=function(e){var t=new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"});return t.digestString(e)},this.sha256Hex=function(e){var t=new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"});return t.digestHex(e)},this.sha512=function(e){var t=new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"});return t.digestString(e)},this.sha512Hex=function(e){var t=new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"});return t.digestHex(e)},this.md5=function(e){var t=new KJUR.crypto.MessageDigest({alg:"md5",prov:"cryptojs"});return t.digestString(e)},this.ripemd160=function(e){var t=new KJUR.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"});return t.digestString(e)},this.getCryptoJSMDByName=function(e){}},KJUR.crypto.MessageDigest=function(params){var md=null,algName=null,provName=null;this.setAlgAndProvider=function(alg,prov){alg!=null&&prov===undefined&&(prov=KJUR.crypto.Util.DEFAULTPROVIDER[alg]);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(alg)!=-1&&prov=="cryptojs"){try{this.md=eval(KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[alg]).create()}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+alg+"/"+ex}this.updateString=function(e){this.md.update(e)},this.updateHex=function(e){var t=CryptoJS.enc.Hex.parse(e);this.md.update(t)},this.digest=function(){var e=this.md.finalize();return e.toString(CryptoJS.enc.Hex)},this.digestString=function(e){return this.updateString(e),this.digest()},this.digestHex=function(e){return this.updateHex(e),this.digest()}}if(":sha256:".indexOf(alg)!=-1&&prov=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+alg+"/"+ex}this.updateString=function(e){this.md.update(e)},this.updateHex=function(e){var t=sjcl.codec.hex.toBits(e);this.md.update(t)},this.digest=function(){var e=this.md.finalize();return sjcl.codec.hex.fromBits(e)},this.digestString=function(e){return this.updateString(e),this.digest()},this.digestHex=function(e){return this.updateHex(e),this.digest()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},params!==undefined&&params.alg!==undefined&&(this.algName=params.alg,params.prov===undefined&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},KJUR.crypto.Mac=function(params){var mac=null,pass=null,algName=null,provName=null,algProv=null;this.setAlgAndProvider=function(alg,prov){alg==null&&(alg="hmacsha1"),alg=alg.toLowerCase();if(alg.substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+alg;prov===undefined&&(prov=KJUR.crypto.Util.DEFAULTPROVIDER[alg]),this.algProv=alg+"/"+prov;var hashAlg=alg.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(hashAlg)!=-1&&prov=="cryptojs"){try{var mdObj=eval(KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[hashAlg]);this.mac=CryptoJS.algo.HMAC.create(mdObj,this.pass)}catch(ex){throw"setAlgAndProvider hash alg set fail hashAlg="+hashAlg+"/"+ex}this.updateString=function(e){this.mac.update(e)},this.updateHex=function(e){var t=CryptoJS.enc.Hex.parse(e);this.mac.update(t)},this.doFinal=function(){var e=this.mac.finalize();return e.toString(CryptoJS.enc.Hex)},this.doFinalString=function(e){return this.updateString(e),this.doFinal()},this.doFinalHex=function(e){return this.updateHex(e),this.doFinal()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},params!==undefined&&(params.pass!==undefined&&(this.pass=params.pass),params.alg!==undefined&&(this.algName=params.alg,params.prov===undefined&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},KJUR.crypto.Signature=function(e){var t=null,n=null,r=null,i=null,s=null,o=null,u=null,a=null,f=null,l=null,c=-1,h=null,p=null,d=null,v=null,m=null;this._setAlgNames=function(){this.algName.match(/^(.+)with(.+)$/)&&(this.mdAlgName=RegExp.$1.toLowerCase(),this.pubkeyAlgName=RegExp.$2.toLowerCase())},this._zeroPaddingOfSignature=function(e,t){var n="",r=t/4-e.length;for(var i=0;i<r;i++)n+="0";return n+e},this.setAlgAndProvider=function(e,t){this._setAlgNames();if(t!="cryptojs/jsrsa")throw"provider not supported: "+t;if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new KJUR.crypto.MessageDigest({alg:this.mdAlgName})}catch(n){throw"setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+n}this.init=function(e,t){var n=null;try{t===undefined?n=KEYUTIL.getKey(e):n=KEYUTIL.getKey(e,t)}catch(r){throw"init failed:"+r}if(n.isPrivate===!0)this.prvKey=n,this.state="SIGN";else{if(n.isPublic!==!0)throw"init failed.:"+n;this.pubKey=n,this.state="VERIFY"}},this.initSign=function(e){typeof e["ecprvhex"]=="string"&&typeof e["eccurvename"]=="string"?(this.ecprvhex=e.ecprvhex,this.eccurvename=e.eccurvename):this.prvKey=e,this.state="SIGN"},this.initVerifyByPublicKey=function(e){typeof e["ecpubhex"]=="string"&&typeof e["eccurvename"]=="string"?(this.ecpubhex=e.ecpubhex,this.eccurvename=e.eccurvename):e instanceof KJUR.crypto.ECDSA?this.pubKey=e:e instanceof RSAKey&&(this.pubKey=e),this.state="VERIFY"},this.initVerifyByCertificatePEM=function(e){var t=new X509;t.readCertPEM(e),this.pubKey=t.subjectPublicKeyRSA,this.state="VERIFY"},this.updateString=function(e){this.md.updateString(e)},this.updateHex=function(e){this.md.updateHex(e)},this.sign=function(){this.sHashHex=this.md.digest();if(typeof this.ecprvhex!="undefined"&&typeof this.eccurvename!="undefined"){var e=new KJUR.crypto.ECDSA({curve:this.eccurvename});this.hSign=e.signHex(this.sHashHex,this.ecprvhex)}else if(this.pubkeyAlgName=="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.pubkeyAlgName=="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof KJUR.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof KJUR.crypto.DSA))throw"Signature: unsupported public key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(e){return this.updateString(e),this.sign()},this.signHex=function(e){return this.updateHex(e),this.sign()},this.verify=function(e){this.sHashHex=this.md.digest();if(typeof this.ecpubhex!="undefined"&&typeof this.eccurvename!="undefined"){var t=new KJUR.crypto.ECDSA({curve:this.eccurvename});return t.verifyHex(this.sHashHex,e,this.ecpubhex)}if(this.pubkeyAlgName=="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,e,this.mdAlgName,this.pssSaltLen);if(this.pubkeyAlgName=="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,e);if(this.pubKey instanceof KJUR.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);if(this.pubKey instanceof KJUR.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(e,t){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.initVerifyByPublicKey=function(e){throw"initVerifyByPublicKey(rsaPubKeyy) not supported for this alg:prov="+this.algProvName},this.initVerifyByCertificatePEM=function(e){throw"initVerifyByCertificatePEM(certPEM) not supported for this alg:prov="+this.algProvName},this.initSign=function(e){throw"initSign(prvKey) not supported for this alg:prov="+this.algProvName},this.updateString=function(e){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(e){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(e){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(e){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=e;if(e!==undefined){e.alg!==undefined&&(this.algName=e.alg,e.prov===undefined?this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=e.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),e.psssaltlen!==undefined&&(this.pssSaltLen=e.psssaltlen);if(e.prvkeypem!==undefined){if(e.prvkeypas!==undefined)throw"both prvkeypem and prvkeypas parameters not supported";try{var t=new RSAKey;t.readPrivateKeyFromPEMString(e.prvkeypem),this.initSign(t)}catch(g){throw"fatal error to load pem private key: "+g}}}},KJUR.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}};var utf8tob64u,b64utoutf8;typeof Buffer=="function"?(utf8tob64u=function(e){return b64tob64u((new Buffer(e,"utf8")).toString("base64"))},b64utoutf8=function(e){return(new Buffer(b64utob64(e),"base64")).toString("utf8")}):(utf8tob64u=function(e){return hextob64u(uricmptohex(encodeURIComponentAll(e)))},b64utoutf8=function(e){return decodeURIComponent(hextouricmp(b64utohex(e)))}),define("third-party-libs/rsa.js",function(){}),define("DefaultHttpRequest",["DefaultPromiseFactory","asos.identity.helper","frameloader","asos.identity.sdk.config"],function(e,t,n,r){"use strict";function i(r){function i(e,n){var r=new XMLHttpRequest;return r.withCredentials!==undefined?(t.log("CORS supported (XHR)"),r.open(e,n,!0),r.withCredentials=!0):(t.log("No CORS Support!"),r=null),r}function s(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}this.gatewayURL=r,Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),this.getJSON=function(r,s){return s&&s.query&&s.query.forEach(function(e){r=t.queryString.setValue(r,e.name,e.value)}),e.create(function(e,t){try{var s=i("GET",r);if(!s){var o=new n({url:this.gatewayURL});return o.loadAsync().then(function(t){o.postMessage(t,r).then(function(t){try{var n=t.data;typeof n=="string"&&(n=JSON.parse(n)),e(n),o.dispose()}catch(r){o.dispose()}},function(){o.dispose()})})}s.setRequestHeader("Accept","application/json"),s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&(s.status===200?e(JSON.parse(s.responseText)):t(s))},s.send()}catch(u){t(u)}}.bind(this))},this.postJSON=function(n,r,i){return e.create(function(e,o){try{i&&i.query&&i.query.forEach(function(e){n=t.queryString.setValue(n,e.name,e.value)});var u=new XMLHttpRequest;u.open("POST",n,!0),u.withCredentials=!0,u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),u.onreadystatechange=function(){u.readyState===XMLHttpRequest.DONE&&(u.status===200?e(JSON.parse(u.responseText)):o(u))},u.send(s(r))}catch(a){o(a)}}.bind(this))}}return new i(r.gatewayURL)}),define("thirdparty-wrappers/defaultHttpRequest.js",function(){}),define("CustomerApiHttpRequest",["asos.identity.sdk.initializer","DefaultPromiseFactory","asos.identity.helper","asos.identity.sdk.config"],function(e,t,n,r){"use strict";function i(r,i){return i&&i.query&&i.query.forEach(function(e){r=n.queryString.setValue(r,e.name,e.value)}),t.create(function(t,n){try{e.ready().then(function(e){e.getFreshAccessTokenAsync().then(function(e){s(r,e,t,n)},n)})}catch(i){n(i)}})}function s(e,t,n,i){var s=r.customerApiUrl,u=o("GET",s+e);u.setRequestHeader("Authorization","Bearer "+t),u.onreadystatechange=function(){u.readyState===XMLHttpRequest.DONE&&(u.status===200?n(JSON.parse(u.responseText)):i(u))},u.send()}function o(e,t){var n=new XMLHttpRequest;return n.withCredentials!==undefined?(n.open(e,t,!0),n.withCredentials=!0):n=null,n}return{getJSON:i}}),define("thirdparty-wrappers/customerApiHttpRequest.js",function(){}),define("DefaultPromiseFactory",["cryptoLibs"],function(e){"use strict";function t(e){this.then=function(n,r){var i=e.then(n,r);return new t(i)},this["catch"]=function(n){var r=e["catch"](n);return new t(r)}}function n(){this.resolve=function(n){return new t(e.Promise.resolve(n))},this.reject=function(n){return new t(e.Promise.reject(n))},this.create=function(n){return new t(new e.Promise(n))}}return new n}),define("thirdparty-wrappers/defaultPromiseFactory.js",function(){}),define("Asos.Identity.Web.ClientSdk.OidcWrapper",["asos.identity.task","asos.identity.sdk.customerparser","asos.identity.events","asos.identity.sdk.supportedEventTypes","asos.identity.helper","DefaultHttpRequest","DefaultPromiseFactory","tokenmanager","Asos.Identity.Web.ClientSdk.CheckSession","asos.identity.sdk.asosCookieHandler","asos.identity.sdk.perxCookieHandler"],function(e,t,n,r,i,s,o,u,a,f){"use strict";function l(){function d(e){return l=e,c=v(l),o.create(function(t,n){return l.hash?c.processTokenCallbackAsync(e.hash).then(function(){return a.checkSessionState(c,w).then(t)},n):a.getCurrentState(c).then(function(e){return b(e).then(t)},n)})}function v(e){var t=new u(e);return t.addOnTokenObtained(m),t.addOnTokenExpired(g),t.addOnTokenRemoved(y),t}function m(e){var i=t.getCustomer(e);i.isNewUser&&n.publish(r.onRegistered,i),i.isAnonymous?n.publish(r.onAnonymous,i):n.publish(r.onLoggedIn,i)}function g(e){if(e){var i=t.getCustomer(e);i.isAnonymous||n.publish(r.onSessionExpired,i)}}function y(e){if(e){var i=t.getCustomer(e);i.isAnonymous||n.publish(r.onSessionEnded,i)}}function b(e){return o.create(function(n,r){var i=t.getCustomer(c.getToken());if(e.state==="unchanged"&&i&&i.isAuthenticated)return a.checkSessionState(c,w).then(function(){n()},r);if(e.state==="changed")return T({saveToStorage:!1}).then(function(e){if(e&&!e.isAnonymous())return c.saveToken(e),a.checkSessionState(c,w).then(function(){n()})},function(){c.removeToken(),n()});e.state==="unauthenticated"&&c.removeToken();if(e.state==="recognised")if(i==null||i.isAnonymous)e.state="anonymous";else{c.expired(c.getToken())||c.markTokenAsExpired();if(!e.asosTsCookie)return c.getNewAccessTokenForBrowserSessionAsync().then(function(){n()},r)}if(e.state==="anonymous"){if(!i||!i.isAnonymous||i.customerGuid!==e.data)return c.removeToken(),N().then(function(){n()},r);if(!e.asosTsCookie)return c.removeToken(),N().then(function(){n()},r)}n()})}function w(e){var t=c.getToken();e.data==="changed"&&t&&!t.isAnonymous()&&c.removeToken()}function E(){return c.getToken()?t.getCustomer(c.getToken()):undefined}function S(){return c.profile()}function x(){return c.getFreshAccessTokenAsync()}function T(e){return p.run(function(){var t=i.extend({},{response_type:"id_token token",prompt:"none",defaultQuery:l.defaultQuery.slice(0)},e);return c.generateTokenRequestUrl(t).then(function(e){return s.getJSON(e,{withCredentials:!0,query:t.defaultQuery}).then(function(e){return C(e).then(function(e){return c.transformToken(e)})})})})}function N(e){return h.run(function(){var t=i.extend({},{response_type:"id_token token",acr_values:"0",defaultQuery:l.defaultQuery.slice(0),saveToStorage:!0},e),n=E(),r=n&&n.isAnonymous?n.customerGuid:f.readCustomerGuid();return r&&t.defaultQuery.push({name:"cgd",value:r}),c.generateTokenRequestUrl(t).then(function(e){return s.getJSON(e,{withCredentials:!0,query:t.defaultQuery}).then(function(e){return C(e).then(function(e){return t.saveToStorage&&c.saveToken(e),c.transformToken(e)})},function(e){i.error("errored: "+e.message)})})})}function C(e){var t=c;return t.oidcClient.processResponseAsync(e).then(function(e){return e},function(e){i.error(e.message)})}function k(e){c.redirectForToken(e)}function L(){c.redirectForLogout()}function A(){return c.getToken()}var l=undefined,c=undefined,h=new e,p=new e;return{init:d,customer:E,profile:S,authorize:k,logout:L,loadAnonToken:N,getAccessToken:A,getFreshAccessTokenAsync:x,getCurrentStateCallback:b,checkSessionStateCallback:w,checkIfAuthenticated:T,handleAnonCallback:C}}return l}),define("thirdparty-wrappers/OpenIdComponentWrapper.js",function(){}),define("frameloader",["DefaultPromiseFactory","asos.identity.helper"],function(e,t){"use strict";function n(e){e&&(this.url=e.url,this.id=e.id),this.callback=function(e){this.messageCallbackHandler(e)}}return n.prototype.messageCallbackHandler=function(e){function t(e){if(!e||!e.data||e.origin!==this.target)return undefined;var t;try{t=JSON.parse(e.data)}catch(n){return undefined}return!t||t.sig!==this.id?undefined:{origin:e.origin,data:t.data}}try{var n=t.call(this,e);n&&this.resolve(n)}catch(r){console.error(r)}},n.prototype.postMessage=function(t,n){function i(){if(this.listenerSubscribed)return;window.addEventListener?window.addEventListener("message",this.callback.bind(this),!1):window.attachEvent("onmessage",this.callback.bind(this)),this.listenerSubscribed=!0}var r=(t.currentTarget||t.srcElement).contentWindow;return e.create(function(e,t){this.resolve=e;try{var s=JSON.stringify({sig:this.id,data:n});i.call(this),r.postMessage(s,this.target)}catch(o){t(o)}}.bind(this))},n.prototype.dispose=function(){window.removeEventListener?window.removeEventListener("message",this.callback.bind(this),!1):window.detachEvent("onmessage",this.callback.bind(this)),document.body.removeChild(this.frame)},n.prototype.loadAsync=function(n){return this.url=n||this.url,this.id=this.id||t.getRandomId(),this.url?(this.target=t.getOrigin(this.url),e.create(function(e,t){function n(t){var n={currentTarget:t.currentTarget||t.srcElement};e(n)}try{this.frame=window.document.createElement("iframe"),this.frame.setAttribute("id",this.id),this.frame.setAttribute("name",this.id),this.frame.style.display="none",this.frame.src=this.url,this.frame.attachEvent?this.frame.attachEvent("onload",n):this.frame.onload=n,window.document.body.appendChild(this.frame)}catch(r){t(r)}}.bind(this))):e.reject("No url provided")},n}),define("thirdparty-wrappers/frameloader.js",function(){}),define("tokenmanager",["oidc.client","frameloader","DefaultHttpRequest","asos.identity.helper","asos.identity.storage","asos.identity.sdk.tokenExchanger","DefaultPromiseFactory"],function(e,t,n,r,i,s,o){"use strict";function u(e){if(e){this.profile=e.profile,this.id_token=e.id_token,e.access_token instanceof Object?this.access_token=null:(this.access_token=e.access_token,e.access_token&&(this.access_token_expires_at=e.access_token_expires_at),this.scopes=(e.scope||"").split(" "));if(!e.id_token)throw Error("Either access_token or id_token required.");this.expires_at=e.profile.exp,this.session_state=e.session_state,e.marked_as_expired?this.marked_as_expired=e.marked_as_expired:this.marked_as_expired=!1}else this.expires_at=0;this.timeLeftToExpire=function(e){var t=parseInt((new Date).getTime()/1e3);return e-t},this.accessTokenExpired=function(){return this.timeLeftToExpire(this.access_token_expires_at)<0},this.accessTokenExpiresIn=function(){return this.timeLeftToExpire(this.access_token_expires_at)},this.expired=function(){return this.timeLeftToExpire(this.expires_at)<0||this.marked_as_expired},this.expiresIn=function(){return this.timeLeftToExpire(this.expires_at)}}function a(e){e._token=null;if(e._settings.persist){var t=e.getTokenFromStorage();t?e._token=t:e.dropToken()}}function f(e){function n(){t=null,r.log("token expiring"),e._callTokenExpiring()}function i(){t&&(window.clearTimeout(t),t=null)}function s(e){t=window.setTimeout(n,e*1e3)}function o(){i();if(!e.expired(e.getToken())){var t=e.expiresIn();t>60?s(t-60):n()}}var t=null;o(),e.addOnTokenObtained(o),e.addOnTokenRemoved(i)}function l(e){e._settings.silent_renew&&e.addOnTokenExpiring(function(){e.renewTokenSilentAsync()["catch"](function(t){e._callSilentTokenRenewFailed(),r.log(t.message||t)})})}function c(e){function n(){t=null,e._callTokenExpired(e.getToken())}function r(){t&&(window.clearTimeout(t),t=null)}function i(e){t=window.setTimeout(n,e*1e3)}function s(){r(),e.expiresIn()>0&&i(e.expiresIn()+1)}var t=null;s(),e.addOnTokenObtained(s),e.addOnTokenRemoved(r)}function h(t){this._settings=r.extend({},t,{persist:!0,persistKey:"Asos.TokenManager.token",current_user_state:r.rand(),access_token_lock_key:"Asos.TokenManager.access_token_lock"}),this.oidcClient=new e(this._settings),this._callbacks={tokenRemovedCallbacks:[],tokenExpiringCallbacks:[],tokenExpiredCallbacks:[],tokenObtainedCallbacks:[],silentTokenRenewFailedCallbacks:[]},this.dropToken=function(){i.local.removeItem(this._settings.persistKey)},this.profile=function(){if(this.getToken())return this.getToken().profile},this.idToken=function(){if(this.getToken())return this.getToken().id_token},this.expired=function(e){return e?e.expired():!0},this.expiresIn=function(){return this.getToken()?this.getToken().expiresIn():0},this.accessTokenExpiresIn=function(){return this.getToken()?this.getToken().accessTokenExpiresIn():0},this.expiresAt=function(){return this.getToken()?this.getToken().expires_at:0},this.scopes=function(){return this.getToken()?[].concat(this.getToken().scopes):[]},this.sessionState=function(){if(this.getToken())return this.getToken().session_state};var n=this;a(n),c(n),l(n),window.setTimeout(function(){f(n)},0)}return u.fromResponse=function(e){if(e.access_token){var t=parseInt((new Date).getTime()/1e3);e.access_token_expires_at=t+parseInt(e.expires_in)}return new u(e)},u.prototype.isAnonymous=function(){return this.profile.amr?this.profile.amr.indexOf("anon")>=0:!1},u.fromJSON=function(e){if(e)try{var t=JSON.parse(e);return new u(t)}catch(n){}return new u(null)},u.prototype.toJSON=function(){return JSON.stringify({profile:this.profile,id_token:this.id_token,access_token:this.access_token,expires_at:this.expires_at,scope:this.scopes.join(" "),session_state:this.session_state,access_token_expires_at:this.access_token_expires_at,marked_as_expired:this.marked_as_expired})},h.prototype.getToken=function(){return this._settings.persist?this.getTokenFromStorage():this._token},h.prototype.setToken=function(e){this.setAccessTokenPending(!1),e||i.local.removeItem(this._settings.persistKey),this._settings.persist&&e&&(i.local.setItem(this._settings.persistKey,e.toJSON()),r.log("Saving token to local storage.")),this._token=e},h.prototype.isAccessTokenFresh=function(){return this.accessTokenExpiresIn()>=this._settings.access_token_renew_threshold_in_seconds},h.prototype.setAccessTokenPending=function(e){e?i.local.setItem(this._settings.access_token_lock_key,"true"):i.local.removeItem(this._settings.access_token_lock_key)},h.prototype.isAccessTokenPending=function(){return i.local.getItem(this._settings.access_token_lock_key)==="true"},h.prototype.waitForPendingTokenRequest=function(){var e=this;return o.create(function(t,n){r.waitCondition(50,2e3,function(){return e.isAccessTokenFresh()},function(){e.setAccessTokenPending(!1),t(e.getToken().access_token)},function(){e.setAccessTokenPending(!1),n({statusCode:500,statusMessage:"Timed out waiting for access token"})})})},h.prototype.getFreshAccessTokenAsync=function(){return o.create(function(e,t){if(this.getToken())if(this.isAccessTokenFresh())e(this.getToken().access_token);else{if(!this.isAccessTokenPending())return this.expired(this.getToken())?this.renewAccessTokenViaTokenExchange().then(function(t){e(t)},function(e){t({statusCode:e.status,statusMessage:e.responseText})}):this.renewTokenSilentAsync(!1).then(function(t){e(t.access_token)},function(e){t(e)});this.waitForPendingTokenRequest().then(e,t)}else e(undefined)}.bind(this))},h.prototype.getNewAccessTokenForBrowserSessionAsync=function(){return o.create(function(e,t){if(this.getToken()&&this.accessTokenExpiresIn()>=this._settings.access_token_renew_threshold_in_seconds)return this.expired(this.getToken())?this.renewAccessTokenViaTokenExchange().then(function(t){e(t)},t):this.renewTokenSilentAsync(!1).then(function(t){e(t.access_token)},t);e()}.bind(this))},h.prototype.ready=function(){return this.oidcClient.loadMetadataAsync().then(function(){return this.oidcClient.loadX509SigningKeyAsync()}.bind(this))},h.prototype.getTokenFromStorage=function(){var e=i.local.getItem(this._settings.persistKey);return e?u.fromJSON(e):null},h.setHttpRequest=function(e){if(typeof e!="object"||typeof e.getJSON!="function")throw Error("The provided value is not a valid http request.");_httpRequest=e},h.prototype._callTokenRemoved=function(e){this._callbacks.tokenRemovedCallbacks.forEach(function(t){t(e)})},h.prototype._callTokenExpiring=function(e){this._callbacks.tokenExpiringCallbacks.forEach(function(t){t(e)})},h.prototype._callTokenExpired=function(e){this._callbacks.tokenExpiredCallbacks.forEach(function(t){t(e)})},h.prototype._callTokenObtained=function(e){this._callbacks.tokenObtainedCallbacks.forEach(function(t){t(e)})},h.prototype._callSilentTokenRenewFailed=function(){this._callbacks.silentTokenRenewFailedCallbacks.forEach(function(e){e()})},h.prototype.transformToken=function(e){return!e||e instanceof u?e:u.fromResponse(e)},h.prototype.updateAccessToken=function(e){if(this.getToken()){r.log("Saving renewed access token to local storage.");var t=this.getToken();t.access_token=e.access_token,t.access_token_expires_at=parseInt((new Date(e.expires)).getTime()/1e3),this.setToken(t)}},h.prototype.renewAccessTokenViaTokenExchange=function(){return this.setAccessTokenPending(!0),r.log("Renewing access token via token exchange."),s.renewAccessToken(this.idToken()).then(function(e){return this.updateAccessToken(e),e.access_token}.bind(this))},h.prototype.saveToken=function(e,t){t=typeof t!="undefined"?t:!0,e=this.transformToken(e);var n=this.getToken();this.expired(e)?(r.log("this._settings.persist="+this._settings.persist+"--"+"this.expired()="+this.expired(e)),this.dropToken()):this.setToken(e),t&&(e?this._callTokenObtained(e):this._callTokenRemoved(n))},h.prototype.addOnTokenRemoved=function(e){this._callbacks.tokenRemovedCallbacks.push(e)},h.prototype.addOnTokenObtained=function(e){this._callbacks.tokenObtainedCallbacks.push(e)},h.prototype.addOnTokenExpiring=function(e){this._callbacks.tokenExpiringCallbacks.push(e)},h.prototype.addOnTokenExpired=function(e){this._callbacks.tokenExpiredCallbacks.push(e)},h.prototype.addOnSilentTokenRenewFailed=function(e){this._callbacks.silentTokenRenewFailedCallbacks.push(e)},h.prototype.removeToken=function(){this.saveToken(null)},h.prototype.generateTokenRequestUrl=function(e){var t=this.oidcClient;return t.createTokenRequestAsync(e).then(function(e){return e.url},function(e){r.error("TokenManager.redirectForToken error: "+(e&&e.message||e||""))})},h.prototype.redirectForToken=function(e){return this.generateTokenRequestUrl(e).then(function(e){window.location=e},function(e){r.error("TokenManager.redirectForToken error: "+(e&&e.message||e||""))})},h.prototype.redirectForLogout=function(){var e=this;e.oidcClient.createLogoutRequestAsync(e.idToken()).then(function(t){e.removeToken(),window.location=t},function(e){r.error("TokenManager.redirectForLogout error: "+(e&&e.message||e||""))})},h.prototype.processTokenCallbackAsync=function(e){r.log("TokenManager.prototype.processTokenCallbackAsync");var t=this;return t.oidcClient.parseOidcResult(e).then(function(e){return t.oidcClient.processResponseAsync(e).then(function(e){t.saveToken(e)})})},h.prototype.renewTokenSilentAsync=function(e){this.setAccessTokenPending(!0),e=typeof e!="undefined"?e:!0;var t=this;return r.log("Renewing token."),o.create(function(i,s){t.oidcClient.createTokenRequestAsync().then(function(o){var u={withCredentials:!0};t._settings.defaultQuery&&(u.query=t._settings.defaultQuery),r.log("Get json from: "+o.url),n.getJSON(o.url,u).then(function(n){t.oidcClient.processResponseAsync(n).then(function(n){t.saveToken(n,e),i(n)},s)},s)},s)})},h.prototype.processTokenCallbackSilent=function(e){if(window.top&&window!==window.top){var e=e||window.location.hash;e&&window.top.postMessage(e,location.protocol+"//"+location.host)}},h.prototype.markTokenAsExpired=function(){r.log("Marking token as expired");var e=this.getToken();e.marked_as_expired=!0,this.setToken(e)},h}),define("thirdparty-wrappers/tokenmanager.js",function(){}),define("cryptoLibs",[],function(){return{KJUR:window.KJUR,hextob64u:window.hextob64u,Promise:window.Promise}}),define("thirdparty-wrappers/cryptoLibs.js",function(){}),define("oidc.client",["asos.identity.helper","DefaultHttpRequest","DefaultPromiseFactory","asos.identity.storage","cryptoLibs"],function(e,t,n,r,i){function s(){var t=[].join.call(arguments);e.log(t)}function o(e,t){t=t||{};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function u(t){if(!t)throw"settings is not provided";this._settings=e.extend({},t,{post_logout_redirect_uri:window.location.href,redirect_uri:window.location.href}),this.isOidc=function(){if(this._settings.response_type){var e=this._settings.response_type.split(/\s+/g).filter(function(e){return e==="id_token"});return!!e[0]}return!1},this.isOAuth=function(){if(this._settings.response_type){var e=this._settings.response_type.split(/\s+/g).filter(function(e){return e==="token"});return!!e[0]}return!1}}return u.prototype.parseOidcResult=function(e){e=e||location.hash;var t=e.lastIndexOf("#");t>=0&&(e=e.substr(t+1));var r={},i=/([^&=]+)=([^&]*)/g,s,o=0;while(s=i.exec(e)){r[decodeURIComponent(s[1])]=decodeURIComponent(s[2]);if(o++>50)return{error:"Response exceeded expected number of parameters"}}for(var u in r)return n.resolve(r)},u.prototype.error=function(e){return n.reject(new Error(e))},u.prototype.getJson=function(e,n){var r={};return this._settings.defaultQuery&&(r.query=this._settings.defaultQuery),n&&(r.headers={Authorization:"Bearer "+n}),t.getJSON(e,r)},u.prototype.loadMetadataAsync=function(){var t=this._settings;return t.metadata=JSON.parse(r.session.getItem(t.well_known_configuration)),t.metadata?n.resolve(t.metadata):t.well_known_configuration?this.getJson(t.well_known_configuration).then(function(n){return e.log("loaded"),t.metadata=n,r.session.setItem(t.well_known_configuration,JSON.stringify(n)),n},function(e){return this.error("Failed to load metadata ("+e.message+")")}.bind(this)):this.error("No authority configured")},u.prototype.loadX509SigningKeyAsync=function(){function t(e){if(!e.keys||!e.keys.length)return this.error("Signing keys empty");var t=e.keys[0];return t.kty!=="RSA"?this.error("Signing key not RSA"):!t.x5c||!t.x5c.length?this.error("RSA keys empty"):n.resolve(t.x5c[0])}var e=this._settings;return e.jwks?t(e.jwks):this.loadMetadataAsync().then(function(i){return i.jwks_uri?(e.jwks=JSON.parse(r.session.getItem(i.jwks_uri)),e.jwks?n.resolve(t(e.jwks)):this.getJson(i.jwks_uri).then(function(n){return e.jwks=n,r.session.setItem(i.jwks_uri,JSON.stringify(n)),t(n)},function(e){return this.error("Failed to load signing keys ("+e.message+")")}.bind(this))):this.error("Metadata does not contain jwks_uri")}.bind(this))},u.prototype.loadUserProfile=function(e){return this.loadMetadataAsync().then(function(t){return t.userinfo_endpoint?this.getJson(t.userinfo_endpoint,e):n.reject(new Error("Metadata does not contain userinfo_endpoint"))}.bind(this))},u.prototype.loadAuthorizationEndpoint=function(){return s("OidcClient.loadAuthorizationEndpoint"),this._settings.authorization_endpoint?n.resolve(this._settings.authorization_endpoint):this._settings.well_known_configuration?this.loadMetadataAsync().then(function(e){return e.authorization_endpoint?e.authorization_endpoint:this.error("Metadata does not contain authorization_endpoint")}.bind(this)):this.error("No authorization_endpoint configured")},u.prototype.createTokenRequestAsync=function(t){s("OidcClient.createTokenRequestAsync");var n=this,i=e.extend({},n._settings,t);return n.loadAuthorizationEndpoint().then(function(t){var s=e.rand(),o=t+"?"+"state="+encodeURIComponent(s);if(n.isOidc()){var u=e.rand();o+="&nonce="+encodeURIComponent(u)}var a=["client_id","redirect_uri","response_type","scope"];a.forEach(function(e){var t=i[e];t&&(o+="&"+e+"="+encodeURIComponent(t))});var f=["prompt","display","max_age","ui_locales","id_token_hint","login_hint","acr_values","response_mode"];f.forEach(function(e){var t=i[e];t&&(o+="&"+e+"="+encodeURIComponent(t))}),i.defaultQuery&&i.defaultQuery.forEach(function(t){o=e.queryString.setValue(o,t.name,t.value)});var l={oidc:n.isOidc(),oauth:n.isOAuth(),state:s};return u&&(l.nonce=u),r.local.setItem(i.request_state_key,JSON.stringify(l)),{request_state:l,url:o}})},u.prototype.createLogoutRequestAsync=function(e){s("OidcClient.createLogoutRequestAsync");var t=this._settings;return this.loadMetadataAsync().then(function(n){if(!n.end_session_endpoint)return this.error("No end_session_endpoint in metadata");var r=n.end_session_endpoint;return e&&t.post_logout_redirect_uri&&(r+="?post_logout_redirect_uri="+encodeURIComponent(t.post_logout_redirect_uri),r+="&id_token_hint="+encodeURIComponent(e),r+="&ui_locales="+t.ui_locales),r}.bind(this))},u.prototype.validateIdTokenAsync=function(e,t,n){var r=this._settings;return this.loadX509SigningKeyAsync().then(function(n){var s=new i.KJUR.jws.JWS;if(s.verifyJWSByPemX509Cert(e,n)){var o=JSON.parse(s.parsedJWS.payloadS);return t!==o.nonce?this.error("Invalid nonce"):this.loadMetadataAsync().then(function(e){if(o.iss!==e.issuer)return this.error("Invalid issuer");if(o.aud!==r.client_id)return this.error("Invalid audience");var t=parseInt(Date.now()/1e3),n=t-o.iat;return n>300?this.error("Token issued too long ago"):o.exp<t?this.error("Token expired"):o}.bind(this))}return this.error("JWT failed to validate")}.bind(this))},u.prototype.validateAccessTokenAsync=function(e,t){s("OidcClient.validateAccessTokenAsync");if(!e.at_hash)return this.error("No at_hash in id_token");var r=i.KJUR.crypto.Util.sha256(t),o=r.substr(0,r.length/2),u=i.hextob64u(o);return u!==e.at_hash?this.error("at_hash failed to validate"):n.resolve()},u.prototype.validateIdTokenAndAccessTokenAsync=function(e,t,n){s("OidcClient.validateIdTokenAndAccessTokenAsync");var r=this;return r.validateIdTokenAsync(e,t,n).then(function(e){return r.validateAccessTokenAsync(e,n).then(function(){return e})})},u.prototype.processResponseAsync=function(e){s("OidcClient.processResponseAsync");var t=this,i=t._settings,o=r.local.getItem(i.request_state_key);r.local.removeItem(i.request_state_key);if(!o)return this.error("No request state loaded");o=JSON.parse(o);if(!o)return this.error("No request state loaded");if(!o.state)return this.error("No state loaded");if(!e)return this.error("No OIDC response");if(e.error)return this.error(e.error);if(e.state!==o.state)return this.error("Invalid state");if(o.oidc){if(!e.id_token)return this.error("No identity token");if(!o.nonce)return this.error("No nonce loaded")}if(o.oauth){if(!e.access_token)return this.error("No access token");if(!e.token_type||e.token_type.toLowerCase()!=="bearer")return this.error("Invalid token type");if(!e.expires_in)return this.error("No token expiration")}var u=n.resolve();return o.oidc&&o.oauth?u=t.validateIdTokenAndAccessTokenAsync(e.id_token,o.nonce,e.access_token):o.oidc&&(u=t.validateIdTokenAsync(e.id_token,o.nonce)),u.then(function(t){if(t&&i.filter_protocol_claims){var n=["nonce","at_hash","iat","nbf","aud","iss"];n.forEach(function(e){delete t[e]})}return{profile:t,id_token:e.id_token,access_token:e.access_token,expires_in:e.expires_in,scope:e.scope,session_state:e.session_state}})},u}),define("third-party-libs/oidc-client.js",function(){}),define("Asos.Identity.Web.ClientSdk.CheckSession",["DefaultPromiseFactory","asos.identity.helper","frameloader","asos.identity.sdk.config"],function(e,t,n,r){"use strict";function i(){function i(e,r,i){var s=t.queryString.setValue(e.check_session_iframe,"ui_locales",e.locale),o=new n;return o.loadAsync(s).then(function(t){var n=window.setInterval(function(){var s=e.client_id+" "+e.session_state;return o.postMessage(t,s).then(function(e){if(e.data==="changed"||e.data==="error")window.clearInterval(n),o.dispose();r(e)},function(e){o.dispose(),i(e)})},2e3)})}function s(e){return{check_session_iframe:r.check_session_iframe,session_state:e.sessionState(),client_id:e._settings.client_id,locale:e._settings.ui_locales}}function o(e){return e.session_state?e.check_session_iframe?e.client_id?!0:(console.error("No client_id passed to RP session frame"),!1):(console.error("No check_session_iframe passed to RP session frame"),!1):(console.error("No session_state passed to RP session frame"),!1)}function u(e,n,r){var u=s(e);if(u.check_session_iframe&&u.session_state){t.log("check_session_frame",u);if(!!o(u))return i(u,n,r);r()}}function a(t){return e.create(function(e,r){var i={check_login_iframe:t._settings.checkLoginIframeUrl,session_state:t.sessionState(),client_id:t._settings.client_id},s=new n({url:i.check_login_iframe});return s.loadAsync().then(function(t){var n={client_id:i.client_id,session_state:i.session_state},o=JSON.stringify(n);return s.postMessage(t,o).then(function(t){s.dispose(),t&&t.data&&e(JSON.parse(t.data))},function(e){s.dispose(),r(e)})})})}function f(t){return e.create(function(e,n){return t.oidcClient.loadMetadataAsync().then(function(){return u(t,e,n)},n)})}return{getCurrentState:a,checkSessionState:f}}return new i}),define("widget/sdk/asos.identity.sdk.checksession.js",function(){}),define("asos.identity.sdk.initializer",["DefaultPromiseFactory","asos.identity.storage","asos.identity.helper","Asos.Identity.Web.ClientSdk.OidcWrapper","asos.identity.sdk.config","asos.identity.events","asos.identity.task"],function(e,t,n,r,i,s,o){"use strict";function u(){function u(){return s?e.resolve(s):t.run(a).then(function(e){return s=e,s})}function a(){return i.hash=f(window.location.hash),i.hash&&(window.location.hash=window.location.hash.replace(i.hash.substring(1),"")),e.create(function(e,t){return l().then(function(){e(n)},t)})}function f(e){var t=e.indexOf("id_token=");if(t>=0)return"#"+e.substring(t)}function l(){return n.init(i)}var t=new o,n=new r(i),s=null;return{ready:u,getIdentityHash:f,initialiseComponent:l}}return new u}),define("widget/sdk/asos.identity.sdk.initializer.js",function(){}),define("asos.identity.sdk.config",["asos.identity.helper"],function(e){"use strict";function n(t){var n=t.auth_host+"/register";return n=e.queryString.setValue(n,"store",t.store),n=e.queryString.setValue(n,"country",t.country),n=e.queryString.setValue(n,"lang",t.ui_locales),n=e.queryString.setValue(n,"keyStoreDataversion",t.keyStoreDataversion),e.queryString.setValue(n,"redirect_uri",t.redirect_uri)}var t={initialised:!1,defaultQuery:[],persistKey:"Asos.TokenManager.token",buildNumber:"1551704232152",setConfig:function(r){this.initialised=!0,this.client_id=r.clientId,this.auth_host=r.authenticationHost,this.identity_origin=r.identityOrigin,this.silent_renew=r.silentRenew||!1,this.ui_locales=r&&r.lang?r.lang:"en-gb",this.well_known_configuration=r.authenticationHost,this.scope=r.scope||"openid sensitive profile",this.types=r.types||"id_token token",this.response_mode=r.responseMode||"json",this.checkLoginIframeUrl=r.checkLoginUrl,this.gatewayURL=r.gatewayUrl,this.customerApiUrl=r.customerApiUrl,this.check_session_iframe=r.checkSessionUrl,this.access_token_renew_threshold_in_seconds=r.access_token_renew_threshold_in_seconds||120,this.store=r.store,this.country=r.countryCode,this.keyStoreDataversion=r.keyStoreDataversion,t.check_session_iframe=t.check_session_iframe?t.check_session_iframe:t.auth_host+"/resource/checksession",t.checkLoginIframeUrl=t.checkLoginIframeUrl?t.checkLoginIframeUrl:t.auth_host+"/resource/checklogin?path=1",t.gatewayURL=t.gatewayURL?t.gatewayURL:t.auth_host+"/resource/gateway",t.check_session_iframe=e.queryString.setValue(t.check_session_iframe,"n",t.buildNumber),t.checkLoginIframeUrl=e.queryString.setValue(t.checkLoginIframeUrl,"n",t.buildNumber),t.gatewayURL=e.queryString.setValue(t.gatewayURL,"n",t.buildNumber),t.defaultTokenExchangeEndpoint=t.auth_host+"/oauth/v2/token/exchange",r.post_logout_redirect_uri&&(this.post_logout_redirect_uri=r.post_logout_redirect_uri),r.redirect_uri&&(this.redirect_uri=r.redirect_uri);if(t.identity_origin){var i={name:"x-identity-origin",value:t.identity_origin};t.check_session_iframe=e.queryString.setValue(t.check_session_iframe,i.name,i.value),t.checkLoginIframeUrl=e.queryString.setValue(t.checkLoginIframeUrl,i.name,i.value),t.gatewayURL=e.queryString.setValue(t.gatewayURL,i.name,i.value),t.defaultQuery.push(i)}t.store&&t.defaultQuery.push({name:"store",value:t.store}),t.country&&t.defaultQuery.push({name:"country",value:t.country}),t.keyStoreDataversion&&t.defaultQuery.push({name:"keyStoreDataversion",value:t.keyStoreDataversion}),t.defaultQuery.push({name:"lang",value:t.ui_locales}),t.request_state_key||(t.request_state_key="OidcClient.request_state"),typeof t.load_user_profile=="undefined"&&(t.load_user_profile=!0),typeof t.filter_protocol_claims=="undefined"&&(t.filter_protocol_claims=!0),t.well_known_configuration&&(t.well_known_configuration[t.auth_host.length-1]!=="/"&&(t.well_known_configuration+="/"),t.well_known_configuration+=".well-known/openid-configuration"),t.response_type||(t.response_type="id_token token"),t.registrationUrl=n(t)}};return t}),define("widget/sdk/asos.identity.sdk.config.js",function(){}),define("Asos.Identity.Web.ClientSdk.Customer",["asos.identity.helper","DefaultPromiseFactory","asos.identity.sdk.initializer","asos.identity.sdk.customerprofile"],function(e,t,n,r){"use strict";function i(){function e(){return n.ready().then(function(e){var t=e.customer();return t?t:e.loadAnonToken().then(function(){return e.customer()})})}function i(n){return t.create(function(t,r){return e().then(function(e){t(n(e))},r)})}function s(){return i(function(e){return e?e.isRecognised:!1})}function o(){return i(function(e){return e?e.firstName:undefined})}function u(){return i(function(e){return e?e.lastName:undefined})}function a(){return t.create(function(t,n){return e().then(function(e){t(e.customerGuid)},n)})}function f(){return i(function(e){return e?e.customerId:undefined})}function l(){return i(function(e){return e?e.firstTimeBuyer:undefined})}function c(){return i(function(e){return e?e.homeSite:undefined})}function h(){return i(function(e){return e&&e.subscriptions?[e.subscriptions]:[]})}function p(){return i(function(e){return e?e.isAuthenticated:!1})}function d(n){return t.create(function(t,r){return e().then(function(e){e&&e.customerId?n(e.customerId).then(function(e){t(e)},r):t(undefined)},r)})}function v(){return d(r.getSubscription)}function m(){return d(r.getRewards)}function g(){return d(r.getIsReconsentRequired)}function y(){return d(r.getPreferences)}function b(){r.deCache()}return{profile:e,isRecognised:s,firstName:o,lastName:u,customerGuid:a,customerId:f,firstTimeBuyer:l,homeSite:c,subscriptions:h,subscriptionDetails:v,isReconsentRequired:g,preferences:y,rewards:m,isAuthenticated:p,resetLocalCopy:b}}return i}),define("widget/sdk/AsosIdentityCustomer.js",function(){}),define("asos.identity.web.clientsdk",["DefaultPromiseFactory","asos.identity.helper","asos.identity.events","Asos.Identity.Web.ClientSdk.Customer","asos.identity.sdk.supportedEventTypes","asos.identity.sdk.initializer","asos.identity.sdk.config","asos.identity.sdk.storagecleardown","asos.identity.sdk.constants.deprecatedKeys"],function(e,t,n,r,i,s,o,u,a){"use strict";if(!o.initialised)throw{message:"asos.identity.sdk.config has not been initialised. Please call require('asos.identity.web.clientsdk/dist/asos.identity.sdk.config').setConfig(....)"};var f=function(){this.preInitialiseSteps();var e=function(e){n.subscribe(i.onLoggedIn,e);try{s.ready().then(function(t){var n=t.customer();n&&n.isAuthenticated&&e(n)}.bind(this))}catch(r){t.error(r)}return this};this.customer=new r,this.events={onLoggedIn:e.bind(this),onRegistered:function(e){return n.subscribe(i.onRegistered,e),this}.bind(this),onSessionEnded:function(e){return n.subscribe(i.onSessionEnded,e),this}.bind(this),onAnonymous:function(e){return n.subscribe(i.onAnonymous,e),this}.bind(this),onSessionExpired:function(e){return n.subscribe(i.onSessionExpired,e),this}.bind(this)}};return f.prototype.preInitialiseSteps=function(){u.clearDownStorageKeys(t.getStorage(),a.tokenmanagerKeys)},f.prototype.getAccessToken=function(){return e.create(function(e,t){s.ready().then(function(n){n.getFreshAccessTokenAsync().then(function(r){r?e(r):n.loadAnonToken().then(function(t){e(t.access_token)}.bind(this),function(e){t(e)}.bind(this))}.bind(this),function(e){e.statusCode===401&&this.login(),t("Failed to get access token. "+(e.statusMessage?e.statusMessage:e))}.bind(this))}.bind(this),function(e){t(e)})}.bind(this))},f.prototype.ready=function(){return s.ready()},f.prototype.login=function(){s.ready().then(function(e){try{var n=t.extend({},o,{response_mode:"fragment"});e.authorize(n)}catch(r){t.error(r)}})},f.prototype.logout=function(){s.ready().then(function(e){e.logout()})},new f}),define("widget/sdk/asos.identity.sdk.main.js",function(){}),define("asos.identity.sdk.supportedEventTypes",[],function(){"use strict";return{onLoggedIn:"asos.identity.sdk.loggedin",onSessionEnded:"asos.identity.sdk.sessionend",onAnonymous:"asos.identity.sdk.anontoken",onSessionExpired:"asos.identity.sdk.expired",onRegistered:"asos.identity.sdk.registered"}}),define("widget/sdk/asos.identity.sdk.supportedEventTypes.js",function(){}),define("asos.identity.sdk.asosCookieHandler",["asos.identity.helper","asos.identity.events","asos.identity.sdk.supportedEventTypes"],function(e,t,n){"use strict";function r(){t.subscribe(n.onAnonymous,function(e){var t=this.readCustomerGuid();t||this.setCustomerGuid(e.customerGuid?e.customerGuid:e.customerId)}.bind(this)),t.subscribe(n.onLoggedIn,function(e){this.setCustomerGuid(e.customerGuid),this.setCustomerId(e.customerId)}.bind(this)),t.subscribe(n.onSessionEnded,function(){this.remove(this.constants.customerGuidName),this.setCustomerId("-1")}.bind(this)),t.subscribe(n.onSessionExpired,function(){this.remove(this.constants.customerGuidName),this.setCustomerId("-1")}.bind(this))}return r.prototype.constants={asosCookieName:"asos",customerGuidName:"customerguid",customerIdName:"customerid"},r.prototype.readCustomerGuid=function(){var e=this.getAsosCookie();if(e){var t=e.filter(function(e){return e&&e.name&&e.value&&e.name.toLowerCase()===this.constants.customerGuidName}.bind(this));if(t&&t.length>0&&t[0].value)return t[0].value}return undefined},r.prototype.getAsosCookie=function(t){var n=e.cookies.getAll().filter(function(e){return e.name.toLowerCase()===this.constants.asosCookieName}.bind(this));return n[0]&&n[0].value?n[0].value.split("&").map(function(e){var t=e.indexOf("=");if(t>0){var n=e.substring(0,t);return{name:n.trim(),value:e.slice(t+1).trim()}}}):undefined},r.prototype.remove=function(t){var n=this.getAsosCookie()||[],r=n.filter(function(e){return e.name.toLowerCase()!==t}.bind(this)).map(function(e){return e.name.toLowerCase()===t?(count++,e.name+"="+value):e.name+"="+e.value});e.cookies.create(this.constants.asosCookieName,r.join("&"),365)},r.prototype.update=function(t,n){var r=(this.getAsosCookie()||[]).concat({name:t,value:n}),i=0,s=r.map(function(e){return e.name.toLowerCase()===t?(i++,e.name+"="+n):e.name+"="+e.value});i>1&&s.splice(-1,1),e.cookies.create(this.constants.asosCookieName,s.join("&"),365)},r.prototype.setCustomerGuid=function(e){this.update(this.constants.customerGuidName,e)},r.prototype.setCustomerId=function(e){this.update(this.constants.customerIdName,e)},new r}),define("widget/sdk/asos.identity.sdk.asosCookieHandler.js",function(){}),define("asos.identity.sdk.perxCookieHandler",["asos.identity.helper","asos.identity.events","asos.identity.sdk.supportedEventTypes"],function(e,t,n){"use strict";function r(){function i(e){var t=e.customerGuid,n=e.sessionId;o([t,"",n])}function s(e){var t=e.customerGuid,n=e.customerAid,r=e.sessionId;o([t,n,r])}function o(t){e.cookies.create(r.perxCookieName,t.join("|"),365)}function u(){var t=e.cookies.getAll().filter(function(e){return e.name.toLowerCase()===r.perxCookieName}.bind(this));return t[0]&&t[0].value?t[0].value:null}var r={perxCookieName:"asos-perx"};return t.subscribe(n.onAnonymous,i),t.subscribe(n.onLoggedIn,s),t.subscribe(n.onSessionEnded,i),{getCookie:u}}return r()}),define("widget/sdk/asos.identity.sdk.perxCookieHandler.js",function(){}),define("asos.identity.sdk.customerparser",["asos.identity.helper"],function(e){"use strict";function t(){}return t.prototype.lastActionEnum={signUpSocial:1,signUpEmail:2,linkAccounts:3,signInSocial:6,signInEmail:7},t.prototype.getCustomer=function(t){if(!t)return;var n={};n.isAnonymous=t.isAnonymous(),n.isRecognised=!n.isAnonymous&&t.expired(),n.isAuthenticated=!t.expired()&&!n.isAnonymous,n.customerId=n.isAnonymous?undefined:t.profile.sub,n.customerGuid=n.isAnonymous?t.profile.sub:t.profile.cgd,n.customerAid=t.profile.aid,n.subscriptions=t.profile.sbs,n.firstTimeBuyer=t.profile.ftb,n.homeSite=t.profile.hom,n.firstName=t.profile.given_name,n.lastName=t.profile.family_name;if(t.access_token){var r=e.parseJwt(t.access_token);n.sessionId=r.sess}var i=t.profile.la;return n.isNewUser=i===this.lastActionEnum.linkAccounts||i===this.lastActionEnum.signUpEmail||i===this.lastActionEnum.signUpSocial,n.lastAction={isSignUpSocial:i===this.lastActionEnum.signUpSocial,isSignUpEmail:i===this.lastActionEnum.signUpEmail,isLinkAccounts:i===this.lastActionEnum.linkAccounts,isSignInSocial:i===this.lastActionEnum.signInSocial,isSignInEmail:i===this.lastActionEnum.signInEmail},n},new t}),define("widget/sdk/asos.identity.sdk.customerparser.js",function(){}),define("asos.identity.sdk.customerprofile",["DefaultPromiseFactory","asos.identity.storage","CustomerApiHttpRequest","asos.identity.events","asos.identity.sdk.supportedEventTypes","asos.identity.task"],function(e,t,n,r,i,s){"use strict";function l(){function s(){var e=t.local.getItem(u.CustomerAdditionalDataStorageKey);return e?JSON.parse(e):null}function l(e){if(e){var n=JSON.stringify(e);t.local.setItem(u.CustomerAdditionalDataStorageKey,n)}else t.local.removeItem(u.CustomerAdditionalDataStorageKey)}function c(){t.local.removeItem(u.CustomerAdditionalDataStorageKey)}function h(e){var t=s(),n=t==null?null:t[e];return n&&n.expiry&&n.expiry<(new Date).getTime()?(t[e]=null,l(t),null):n?n.data:null}function p(e,t,n){var r=s();r||(r={}),r[e]={data:t,expiry:n},l(r)}function d(t,r,i){return o.run(function(){return e.create(function(e,s){var o=r instanceof Array?r:[r];if(t){var u=h(f);u?e(u):n.getJSON("/customer/profile/v2/customers/"+t+"?fields="+o.join()).then(function(t){var n=(new Date).setUTCHours(24,0,0,0);p(f,t,n),e(t)},function(e){s(e)})}else e(i)})})}function v(e){return d(e,a.AcceptedFields,[]).then(function(e){return e.subscriptions})}function m(e){return d(e,a.AcceptedFields,[]).then(function(e){return e.rewards})}function g(e){return d(e,a.AcceptedFields,[]).then(function(e){return e.isReconsentRequired})}function y(e){return d(e,a.AcceptedFields,[]).then(function(e){return e.preferences})}function b(){t.local.removeItem(u.CustomerAdditionalDataStorageKey)}return r.subscribe(i.onAnonymous,c),r.subscribe(i.onSessionEnded,c),{getSubscription:v,getRewards:m,getPreferences:y,getIsReconsentRequired:g,deCache:b}}var o=new s,u={CustomerAdditionalDataStorageKey:"Asos.Identity.CustomerProfile"},a={AcceptedFields:["subscriptions","rewards","isreconsentrequired","preferences"]},f="CustomerInfo";return l()}),define("widget/sdk/asos.identity.sdk.customerprofile.js",function(){}),define("asos.identity.sdk.tokenExchanger",["DefaultPromiseFactory","DefaultHttpRequest","asos.identity.sdk.config"],function(e,t,n){"use strict";function r(){}return r.prototype.renewAccessToken=function(r){return e.create(function(e,i){if(r){var s={Id_Token:r,grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",assertion_format:"JWT",client_id:n.client_id,scope:"sensitive"},o={};return o.query=n.defaultQuery||null,t.postJSON(n.defaultTokenExchangeEndpoint,s,o).then(function(t){e(t)},i)}i()})},new r}),define("widget/sdk/asos.identity.sdk.tokenExchanger.js",function(){}),define("asos.identity.sdk.storagecleardown",[],function(){var e=function(){};return e.prototype.clearDownStorageKeys=function(e,t){if(!t||!e)return;for(var n=0;n<t.length;n++)e.removeItem(t[n])},new e}),define("widget/sdk/asos.identity.sdk.storagecleardown.js",function(){}),define("asos.identity.sdk.constants.deprecatedKeys",[],function(){return{tokenmanagerKeys:["TokenManager.token"]}}),define("widget/sdk/constants/asos.identity.sdk.constants.deprecatedKeys.js",function(){}),define("Asos.Identity.Web.ClientSdk",["asos.identity.web.clientsdk"],function(e){return e}),define("widget/sdk/asos.identity.web.clientsdk.alias.js",function(){}),define("asos.identity.helper",["asos.identity.storage"],function(e){"use strict";var t=window.document;return{rand:function(){return((Date.now()+Math.random())*Math.random()).toString().replace(".","")},getRandomId:function(){return Math.random().toString(36).substring(7)},extend:function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]},error:function(){var e=Array.prototype.slice.call(arguments);try{console.error.apply(console,e)}catch(t){console.error(e)}},getOrigin:function(e){var t=e.indexOf("/",e.indexOf("//")+2);return e.substr(0,t)},getStorage:function(){return e.local},log:function(){var t=function(){return e.local.getItem("sdk.log.enable")};if(!t()){window.sdkLoggingHint||(window.sdkLoggingHint=!0);return}var n=Array.prototype.slice.call(arguments);try{console.log.apply(console,n)}catch(r){console.log(n)}},cookies:{getAll:function(){var e=t.cookie,n=e.split(";");return n.map(function(e){var t=e.trim().split("=");if(t.length>=2){var n=t[0].trim();return{name:n,value:e.trim().slice(n.length+1)}}}).filter(function(e){return e&&e.name&&e.value})},create:function(e,n,r,i){var s="";if(r){var o=new Date;o.setTime(o.getTime()+r*24*60*60*1e3),s="; expires="+o.toGMTString()}t.cookie=e+"="+n+s+"; path="+(i||"/")}},queryString:{getValue:function(e){var t=function(){var e=location.search.slice(1).split("&"),t,n={};for(var r=e.length-1;r>=0;r--)t=e[r].split("="),n[t[0]]?Array.isArray(n[t[0]])?n[t[0]].push(t[1]||""):n[t[0]]=[n[t[0]],t[1]||""]:n[t[0]]=t[1]||"";return n};return t()[e]},setValue:function(e,t,n){n=encodeURIComponent(n);var r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),i=e.indexOf("?")!==-1?"&":"?";return e.match(r)?e.replace(r,"$1"+t+"="+n+"$2"):e+i+t+"="+n}},stringFormat:function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return typeof t[n]!="undefined"?t[n]:e})},waitCondition:function(e,t,n,r,i){var s=0,o=t/e,u=setInterval(function(){s++,n()&&(clearInterval(u),r()),s>=o&&(clearInterval(u),i())},100)},parseJwt:function(e){var t=e.split(".")[1],n=t.replace("-","+").replace("_","/");return JSON.parse(window.atob(n))}}}),define("../Javascript/asos.identity.helper.js",function(){}),define("asos.identity.events",[],function(){"use strict";function e(){this.topics={}}return e.prototype.subscribe=function(e,t){typeof e=="string"&&(e=[e]),e.forEach(function(e){this.topics[e]||(this.topics[e]=[]),this.topics[e].push(t)}.bind(this))},e.prototype.publish=function(e){if(!this.topics[e]||this.topics[e].length<1)return;var t=Array.prototype.slice.call(arguments,1);this.topics[e].forEach(function(e){try{e.apply(null,t)}catch(n){console.error("Failed to invoke callback:",e,"the error is:",n)}})},new e}),define("../Javascript/asos.identity.events.js",function(){}),define("asos.identity.storage",[],function(){"use strict";function e(){this.storagePolyfill=new function(){window.asosStorage=window.asosStorage?window.asosStorage:{},this.getItem=function(e){return window.asosStorage[e]!=undefined?window.asosStorage[e]:null},this.removeItem=function(e){window.asosStorage[e]=undefined},this.setItem=function(e,t){window.asosStorage[e]=t}},this.checkBrowserCompatibility=function(e){if(e){try{e.setItem("fd","true")}catch(t){}if(e.getItem("fd")==="true")return e.removeItem("fd"),!0}return!1},this.setStorageTypes=function(e,t){this.checkBrowserCompatibility(e)?this.local=e:this.local=this.storagePolyfill,this.checkBrowserCompatibility(t)?this.session=t:this.session=this.storagePolyfill}}var t=new e;return t.setStorageTypes(window.localStorage,window.sessionStorage),t}),define("../Javascript/asos.identity.storage.js",function(){}),define("asos.identity.task",["DefaultPromiseFactory","asos.identity.events","asos.identity.helper"],function(e,t,n){"use strict";function r(){function u(){r=!1}function a(t){return e.create(function(e,n){if(!r)return l(t,e,n);f(e)})}function f(e){t.subscribe(s,e)}function l(n,i,a){function f(e){o=e,r=!1,t.publish(s,e),i(e)}function l(e){u(),a(e)}r=!0;try{return e.resolve(n()).then(f,l)}catch(c){l(c)}}var r=!1,i=n.getRandomId(),s="asos.identity.task.onCompleted"+i,o;return{result:o,reset:u,run:a}}return r}),define("../Javascript/asos.identity.task.js",function(){});